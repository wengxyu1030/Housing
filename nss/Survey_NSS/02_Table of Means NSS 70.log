---------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\Housing_git\ns
> s\Survey_NSS\02_Table of Means NSS 70.log
  log type:  text
 opened on:  12 Nov 2020, 03:08:42

. 
. ****************************************************************************
. * Load the data and replicate the assumption https://papers.ssrn.com/sol3/paper
> s.cfm?abstract_id=2797680
. ****************************************************************************
. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri no
> n_farm shares fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec)

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(39,807 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_o
> ther gold fin_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782862    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    66760.63    267276.4          0   3.26e+07
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(672 missing values generated)

. gen du_share = durable_other/asset
(672 missing values generated)

. gen gl_share = gold / asset
(8,631 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,862    .7415179    .2971582          0          1
    du_share |    107,862    .0629695    .1267183          0          1
    gl_share |     99,903    .1089669    .1968698          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,862   454835504    .7437976   .3032802          0          1
    du_share | 107,862   454835504    .0583045    .121603          0          1
    gl_share |  99,903   415267015    .1233037   .2136998          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,862  2.0722e+09    .7639302   .2797367          0          1
    du_share | 107,862  2.0722e+09    .0603331   .1165205          0          1
    gl_share |  99,903  1.9011e+09    .1094104   .1952706          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,
> 581,228 and Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,813,187   602,800
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_othe
> r gold asset"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,3
> 22   490,570

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    52,574    17,930 1,447,452 1,339,411    50,171    63,913 1,561,322
     p50 |     2,200         0   452,000   385,000     9,000    25,000   490,570
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,92
> 8   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    49,179    16,475 1,643,910 1,525,683    59,373    64,471 1,754,928
     p50 |     2,400         0   529,700   455,000    15,000    25,000   567,775
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  52573.712       2200
  fin_retire  17929.947          0
asset_non_~n    1447452     452000
 real_estate  1339411.5     385000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset    1561322     490570

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Ou
> tput Files\m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Dat
> a & Dictionaries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +-------------------------------------------------------------------------+
  1. | mean_tb |  p50_tb |            name_full |     mean |    p50 | delta_~n |
     |  24,681 |   1,350 |      Financial asset | 52573.71 |   2200 |      113 |
     |-------------------------------------------------------------------------|
     |                                delta~50                                 |
     |                                      63                                 |
     +-------------------------------------------------------------------------+

     +-------------------------------------------------------------------------+
  2. | mean_tb |  p50_tb |            name_full |     mean |    p50 | delta_~n |
     |  28,317 |       0 |  Retirement accounts | 17929.95 |      0 |      -37 |
     |-------------------------------------------------------------------------|
     |                                delta~50                                 |
     |                                       .                                 |
     +-------------------------------------------------------------------------+

     +-------------------------------------------------------------------------+
  3. | mean_tb |  p50_tb |            name_full |     mean |    p50 | delta_~n |
     | 1528232 | 478,300 | Non-financial assets |  1447452 | 452000 |       -5 |
     |-------------------------------------------------------------------------|
     |                                delta~50                                 |
     |                                      -5                                 |
     +-------------------------------------------------------------------------+

     +-------------------------------------------------------------------------+
  4. | mean_tb |  p50_tb |            name_full |     mean |    p50 | delta_~n |
     | 1441279 | 407,000 |          Real estate |  1339412 | 385000 |       -7 |
     |-------------------------------------------------------------------------|
     |                                delta~50                                 |
     |                                      -5                                 |
     +-------------------------------------------------------------------------+

     +-------------------------------------------------------------------------+
  5. | mean_tb |  p50_tb |            name_full |     mean |    p50 | delta_~n |
     |  58,660 |  11,680 |        Durable goods | 50170.98 |   9000 |      -14 |
     |-------------------------------------------------------------------------|
     |                                delta~50                                 |
     |                                     -23                                 |
     +-------------------------------------------------------------------------+

     +-------------------------------------------------------------------------+
  6. | mean_tb |  p50_tb |            name_full |     mean |    p50 | delta_~n |
     |  58,292 |  20,000 |         Gold/bullion | 63912.87 |  25000 |       10 |
     |-------------------------------------------------------------------------|
     |                                delta~50                                 |
     |                                      25                                 |
     +-------------------------------------------------------------------------+

     +-------------------------------------------------------------------------+
  7. | mean_tb |  p50_tb |            name_full |     mean |    p50 | delta_~n |
     | 1581228 | 501,880 |          Total asset |  1561322 | 490570 |       -1 |
     |-------------------------------------------------------------------------|
     |                                delta~50                                 |
     |                                      -2                                 |
     +-------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. clear 

. clear matrix

. ****************************************************************************
. 
. ****************************************************************************
. * Determine Whose Machine is running the code and set the global directory
. ****************************************************************************
. if "`c(username)'" == "wb308830" local pc = 0

. if "`c(username)'" != "wb308830" local pc = 1

. if `pc' == 0 global root "C:\Users\wb308830\OneDrive - WBG\Documents\TN\Data\NSS 70\"

. if `pc' != 0 global root "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\N
> SS70"

. if `pc' != 0 global script "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\Housing_
> git\nss\Survey_NSS"

. 
. di "$root"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70

. global r_input "${root}\Raw Data & Dictionaries"

. di "${r_input}"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Dictionaries

. global r_output "${root}\Data Output Files"

. 
. log using "${script}\02_Table of Means NSS 70.log",replace
log file already open
r(604);

end of do-file

r(604);

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec)

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(39,807 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_other gold f
> in_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782862    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    66760.63    267276.4          0   3.26e+07
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(672 missing values generated)

. gen du_share = durable_other/asset
(672 missing values generated)

. gen gl_share = gold / asset
(8,631 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,862    .7415179    .2971582          0          1
    du_share |    107,862    .0629695    .1267183          0          1
    gl_share |     99,903    .1089669    .1968698          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,862   454835504    .7437976   .3032802          0          1
    du_share | 107,862   454835504    .0583045    .121603          0          1
    gl_share |  99,903   415267015    .1233037   .2136998          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,862  2.0722e+09    .7639302   .2797367          0          1
    du_share | 107,862  2.0722e+09    .0603331   .1165205          0          1
    gl_share |  99,903  1.9011e+09    .1094104   .1952706          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,813,187   602,800
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    52,574    17,930 1,447,452 1,339,411    50,171    63,913 1,561,322
     p50 |     2,200         0   452,000   385,000     9,000    25,000   490,570
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    49,179    16,475 1,643,910 1,525,683    59,373    64,471 1,754,928
     p50 |     2,400         0   529,700   455,000    15,000    25,000   567,775
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  52573.712       2200
  fin_retire  17929.947          0
asset_non_~n    1447452     452000
 real_estate  1339411.5     385000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset    1561322     490570

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   52573.71     2200        113         63 |
  2. |  28,317         0    Retirement accounts   17929.95        0        -37          . |
  3. | 1528232   478,300   Non-financial assets    1447452   452000         -5         -5 |
  4. | 1441279   407,000            Real estate    1339412   385000         -7         -5 |
  5. |  58,660    11,680          Durable goods   50170.98     9000        -14        -23 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset    1561322   490570         -1         -2 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) - fin_retirea
varlist not allowed
r(101);

end of do-file

r(101);

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. replace asset_fin = asset_fin - fin_retire
(21,766 real changes made, 9,388 to missing)

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. replace asset_fin = asset_fin - fin_retire
(21,766 real changes made, 9,388 to missing)

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(39,807 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_other gold f
> in_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782862    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    66760.63    267276.4          0   3.26e+07
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(672 missing values generated)

. gen du_share = durable_other/asset
(672 missing values generated)

. gen gl_share = gold / asset
(8,631 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,862    .7415179    .2971582          0          1
    du_share |    107,862    .0629695    .1267183          0          1
    gl_share |     99,903    .1089669    .1968698          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,862   454835504    .7437976   .3032802          0          1
    du_share | 107,862   454835504    .0583045    .121603          0          1
    gl_share |  99,903   415267015    .1233037   .2136998          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,862  2.0722e+09    .7639302   .2797367          0          1
    du_share | 107,862  2.0722e+09    .0603331   .1165205          0          1
    gl_share |  99,903  1.9011e+09    .1094104   .1952706          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,813,187   602,800
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    40,067    17,930 1,447,452 1,339,411    50,171    63,913 1,561,322
     p50 |     3,000         0   452,000   385,000     9,000    25,000   490,570
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    37,335    16,475 1,643,910 1,525,683    59,373    64,471 1,754,928
     p50 |     3,000         0   529,700   455,000    15,000    25,000   567,775
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  40067.108       3000
  fin_retire  17929.947          0
asset_non_~n    1447452     452000
 real_estate  1339411.5     385000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset    1561322     490570

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   40067.11     3000         62        122 |
  2. |  28,317         0    Retirement accounts   17929.95        0        -37          . |
  3. | 1528232   478,300   Non-financial assets    1447452   452000         -5         -5 |
  4. | 1441279   407,000            Real estate    1339412   385000         -7         -5 |
  5. |  58,660    11,680          Durable goods   50170.98     9000        -14        -23 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset    1561322   490570         -1         -2 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,5,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inlist(b12_q1,1,4), by(HHID)
parentheses unbalanced
r(132);

end of do-file

r(132);

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,5,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inlist(b12_q1,1,4)), by(HHID)
parentheses unbalanced
r(132);

end of do-file

r(132);

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,5,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inlist(b12_q1,1,4))), by(HHID)

. egen double fin_other_man = sum(b12_q3*(inrange(b12_q1,1,7)| b12_q1 == 10)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   *Check the manual (man) sum with survey sum
.   count if fin_other > fin_other_man
  0

.   count if fin_other < fin_other_man
  79,065

. 
end of do-file

. br fin_other fin_other_man if fin_other < fin_other_man

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. *Asset fin: other financial assets b12 srl 11 
. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,5,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inlist(b12_q1,1,4))), by(HHID)

. egen double fin_other_man = sum(b12_q3*(inrange(b12_q1,1,7)| b12_q1 == 10)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   *Check the manual (man) sum with survey sum
.   count if fin_other > fin_other_man
  0

.   count if fin_other < fin_other_man
  79,065

. 
.   /*
> drop fin_other 
> ren fin_other_man fin_other
> */
. 
. keep HHID fin_other gold fin_retire

. save "${r_output}\b12",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b12.dta saved

. Documents\TN\Data\NSS 70"
command Documents is unrecognized
r(199);

end of do-file

r(199);

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. ****************************************************************************
. * Description: Import NSS70 from Raw Files and save dta to Output Folder
. * Date: Oct 16, 2020
. * Version 1.2
. * Last Editor: Aline
. ****************************************************************************
. 
. ****************************************************************************
. clear 

. clear matrix

. ****************************************************************************
. 
. ****************************************************************************
. * Determine Whose Machine is running the code and set the global directory
. ****************************************************************************
. if "`c(username)'" == "wb308830" local pc = 0

. if "`c(username)'" != "wb308830" local pc = 1

. if `pc' == 0 global root "C:\Users\wb308830\OneDrive - WBG\Documents\TN\Data\NSS 70"

. if `pc' != 0 global root "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\N
> SS70"

. 
. di "$root"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70

. global r_input "${root}\Raw Data & Dictionaries"

. di "${r_input}"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Dictionaries

. global r_output "${root}\Data Output Files"

. 
. ****************************************************************************
. *gen date of survey 
. use "${r_input}\Visit 1_Block 1&2_Identification of sample household and particulars of fi
> eld operations.dta",clear

. gen month = real(substr(Survey_Date,3,2))

. gen year = 2013 //there's 2017 and 2019 should be mistake

. 
. gen date_survey = ym(year,month)

. format date_survey %tmMCY

. 
. keep HHID date_survey

. save "${r_output}\b2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b2.dta saved

. 
. 
. *gen id, wgt (hhwgt, popwgt) b3
. use "${r_input}\Visit 1_Block 3_Household Characteristics.dta",clear

. 
. rename (b3q1 Sector) (hhsize sector)

. //gen hhwgt = MLT 
. gen hhwgt = Weight_SS 

. 
. destring(hhsize),replace
hhsize: all characters numeric; replaced as byte

. gen pwgt = hhwgt * hhsize

. 
. destring(sector), replace
sector: all characters numeric; replaced as byte

. gen urban = sector - 1

. keep HHID hhwgt pwgt hhsize sector urban Weight_SS Weight_SC

. save "${r_output}\b3",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b3.dta saved

. 
. *gender from b4 (4)
. use "${r_input}\Visit 1 _Block 4_Demographic and other particulars of household members.dt
> a",clear

. *Keep head 
. keep if b4q1 == "01" // keep heads only 
(408,795 observations deleted)

. ren b4q5 head_age 

. 
. ren  b4q4 head_gender 

. destring head_gender, replace
head_gender: all characters numeric; replaced as byte

. label define gender 1 "Male" 2 "Female"

. label values head_gender gender 

. gen head_female = (head_gender == 2)*100

. 
. keep HHID head_age head_gender head_female

. save "${r_output}\b4",replace 
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b4.dta saved

. 
. *Asset non_fin： land from b5.1 & b5.2 (rural & urban) srl 99
. use "${r_input}\Visit 1_Block 5pt1_Details of land owned by the household as on 30.06.12.d
> ta",clear

. sum b5_1_6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b5_1_6 |    223,958    630116.4     2835074          0   2.49e+08

. rename State state

. 
. egen double land_r = sum(b5_1_6*(b5_1_1 == "99")), by(HHID)

. egen double land_r_man = sum(b5_1_6*(b5_1_1 != "99")), by(HHID)

. egen double land_r_resid = sum(b5_1_6*(b5_1_1 != "99")*( b5_1_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(156,468 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_r > land_r_man
  0

. count if land_r < land_r_man
  15

. 
. drop land_r

. rename land_r_man land_r 

. 
. keep HHID land_r land_r_resid

. save "${r_output}\b5_1",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_1.dta saved

. 
. use "${r_input}\Visit 1_Block 5pt2_Details of land owned by the household as on 30.06.12.d
> ta",clear

. count if b5_2_6 < 0
  2

. replace b5_2_6 = . if b5_2_6 < 0
(2 real changes made, 2 to missing)

. 
. egen double land_u = sum(b5_2_6*(b5_2_1 == "99")), by(HHID)

. egen double land_u_man = sum(b5_2_6*(b5_2_1 != "99")), by(HHID)

. egen double land_u_resid = sum(b5_2_6*(b5_2_1 != "99")*( b5_2_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(41,892 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_u > land_u_man
  0

. count if land_u < land_u_man
  16

. 
. drop land_u

. rename land_u_man land_u

. 
. keep HHID land_u land_u_resid

. save "${r_output}\b5_2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_2.dta saved

. 
. 
. 
. *Asset non_fin: building and constructions b6 srl 11
. use "${r_input}\Visit 1_Block 6_Buildings and other constructions owned by the household a
> s on 30.06.2012.dta",clear

. sum b6_q6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b6_q6 |    244,737    479786.6     8839515          0   1.85e+09

. 
. egen double building_all = sum(b6_q6*(b6_q3 == "11")), by(HHID)

. egen double building_all_man = sum(b6_q6*(b6_q3 != "11")),  by(HHID)

. 
. egen double building_resid = sum(b6_q6*(b6_q3 == "01")), by(HHID)

. egen double building_dwelling = sum(b6_q6*(inlist(b6_q3,"01","02","03"))), by(HHID)

. 
. egen double building_resid_area = sum(b6_q5*(inlist(b6_q3,"01","02","03"))), by(HHID)

. egen double building_dwelling_area = sum(b6_q5*(b6_q3 == "01")), by(HHID)

. 
. duplicates drop HHID,  force

Duplicates in terms of HHID

(149,298 observations deleted)

. 
. keep HHID building_all* building_resid building_resid_area building_dwelling building_dwel
> ling_area

. 
. *Check the manual (man) sum with survey sum
. count if building_resid > building_all
  2

. count if building_resid > building_all_man
  0

. 
. drop building_all

. ren building_all_man building_all 

. 
. save "${r_output}\b6",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b6.dta saved

. 
. *Asset non_fin: livestock and poultry b7 srl 22 
. use "${r_input}\Visit 1_Block 7_Livestock and poultry owned by the household on 30.06.2012
> .dta",clear

. destring b7_q2,replace
b7_q2: all characters numeric; replaced as byte

. sum b7_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b7_q5 |    176,881    23115.77    42294.12          0    2590000

. 
. egen double livestock = sum(b7_q5*(b7_q2 == 22)), by(HHID)

. egen double livestock_man = sum(b7_q5*(inrange(b7_q2,17,21))), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(132,557 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if livestock > livestock_man
  0

. count if livestock < livestock_man
  14

. 
. drop livestock

. rename livestock_man livestock

. 
. keep HHID livestock

. save "${r_output}\b7",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b7.dta saved

. 
. *Asset non_fin: transport equipment b8: srl 8
. use "${r_input}\Visit 1_Block 8_Transport equipment owned by the household on 30.06.2012.d
> ta",clear

. sum b8_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b8_q5 |    166,428    64309.42      250881          0   2.07e+07

. 
. egen double trspt = sum(b8_q5*(b8_q2 == "08")), by(HHID)

. egen double trspt_man = sum(b8_q5*(b8_q2 != "08")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(94,706 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if trspt > trspt_man
  0

. count if trspt < trspt_man
  9

. 
. drop trspt

. rename trspt_man trspt

. 
. keep HHID trspt

. save "${r_output}\b8",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b8.dta saved

. 
. *Asset non_fin: agricultural machinery and implements b9: srl 8 
. use "${r_input}\Visit 1_Block 9_Agricultural machinery and implements owned by the househo
> ld on 30.06.2012.dta",clear

. sum b9_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b9_q4 |    120,458    7046.966    42346.08         10    7700000

. 
. egen double agri = sum(b9_q4*(b9_q2 == "8")), by(HHID)

. egen double agri_man = sum(b9_q4*(b9_q2 != "8")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(72,196 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if agri > agri_man
  0

. count if agri < agri_man
  2

. 
. drop agri

. rename agri_man agri

. 
. keep HHID agri

. save "${r_output}\b9",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b9.dta saved

. 
. *Asset non_fin: non-farm business equipment b10 srl 15
. use "${r_input}\Visit 1_Block 10_Non-farm business equipment owned by the household as on 
> 30.06.2012.dta",clear

. destring b10_q2,replace
b10_q2: all characters numeric; replaced as byte

. sum b10_q3 //issue with raw-data.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b10_q3 |        119           0           0          0          0

. 
. egen double non_farm = sum(b10_q3*(b10_q2 == 15)), by(HHID)

. egen double non_farm_man = sum(b10_q3*inrange(b10_q2,12,14)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(60,778 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if non_farm > non_farm_man
  0

. count if non_farm < non_farm_man
  0

. 
. drop non_farm_man

. keep HHID non_farm

. save "${r_output}\b10",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b10.dta saved

. 
. *Asset fin: shares & debentures b11 
. use "${r_input}\Visit 1_Block 11_ Shares and debentures owned by the household in co-opera
> tive  societies & companies as on 30.06.2012 .dta",clear

. 
.  *Check the manual (man) sum with survey sum
.   preserve

.   egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

.   egen double shares_man = sum(b11_q6*(b11_q1 != "5")), by(HHID)

.   duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

.   count if shares > shares_man
  0

.   count if shares < shares_man
  0

.   restore 

. 
. sum b11_q6 if b11_q1 != "5" 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b11_q6 |      3,931    44989.44    324279.8     -50000   1.00e+07

. replace b11_q6 = . if b11_q6<0 //filter out the non-negative colums. 
(23 real changes made, 23 to missing)

. egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

. 
. keep HHID shares

. save "${r_output}\b11",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b11.dta saved

. 
. *Asset fin: other financial assets b12 srl 11 
. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,5,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inlist(b12_q1,1,4))), by(HHID)

. egen double fin_other_man = sum(b12_q3*(inrange(b12_q1,1,7)| b12_q1 == 10)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   *Check the manual (man) sum with survey sum
.   count if fin_other > fin_other_man
  0

.   count if fin_other < fin_other_man
  79,065

. 
.   /*
> drop fin_other 
> ren fin_other_man fin_other
> */
. 
. keep HHID fin_other gold fin_retire

. save "${r_output}\b12",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b12.dta saved

. 
. *Asset fin: amount receivable b13 (mortgage srl 1, total srl 7)
. use "${r_input}\Visit 1_Block 13_Amount receivable by the household against different head
> s as on 30.06.2012.dta",clear

. sum b13_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b13_q4 |     13,807    63848.05    419515.8          0   2.00e+07

. 
. egen double fin_rec = sum(b13_q4*(b13_q2 == "7")), by(HHID)

. egen double fin_rec_man = sum(b13_q4*(b13_q2 != "7")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(7,033 observations deleted)

. 
.   *Check the manual (man) sum with survey sum
.   count if fin_rec > fin_rec_man
  0

.   count if fin_rec < fin_rec_man
  2

.  
. drop fin_rec

. ren fin_rec_man fin_rec

. keep HHID fin_rec

. save "${r_output}\b13",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b13.dta saved

. 
. *Debt: cash loands payable b14: Type of loan(8) Purpose of loan (11) Type of mortgage(13) 
> , srl 99 (total)
. use "${r_input}\Visit 1_Block 14",clear

. drop if b14_q1 == "99" //drop the total amount
(73,266 observations deleted)

. 
. *debt
. gen debt = b14_q17
(47,671 missing values generated)

. gen b14 = debt
(47,671 missing values generated)

. 
. *loan purpose
. gen loan_purpose = b14_q11
(4 missing values generated)

. gen hous_loan = (b14_q11 == "11")*debt
(47,671 missing values generated)

. 
. *credit agency
. gen credit_agency = b14_q6
(1 missing value generated)

. 
. destring(b14_q6),replace
b14_q6: all characters numeric; replaced as byte
(1 missing value generated)

. gen credit_formal = (!inrange(b14_q6,12,17)& b14_q6!=9)*debt
(47,671 missing values generated)

. 
. *mortgage
. gen mortgage_type = b14_q13
(7 missing values generated)

. gen has_mortgage =  (b14_q13 != "4")*debt
(47,671 missing values generated)

. 
. *borrowed amount
. gen br_amount = b14_q5
(1 missing value generated)

. 
. *aggregate at household level. *** When you collapse, check if any HH has two housing loan
> s - we don't want to combine them. In fact we should try and do all this in file 03_Mortga
> ge so we can keep file 01 clean while we play around with this data
. collapse (sum) hous_loan (sum) credit_formal (sum) has_mortgage  (sum) br_amount (sum) deb
> t,by(HHID)

. label var hous_loan "loan with purpose on housing"

. label var has_mortgage "loan with mortgage"

. 
. save "${r_output}\b14",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b14.dta saved

. 
. *Debt: kind of loan payable b15 col 11: housing 11
. use "${r_input}\Visit 1_Block 15_kind loans payable by the household.dta",replace

. save "${r_output}\b15",replace //late housing info
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b15.dta saved

. 
. 
. 
. *******merge to master data******************************
. use "${r_output}\b2",clear

. local flist "b3 b14 b13 b12 b11 b10 b9 b8 b7 b6 b5_1 b5_2 b4"

. 
. foreach f of local flist{
  2. merge 1:1 HHID using "${r_output}/`f'"
  3. drop _merge
  4. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        37,081
        from master                    37,081  (_merge==1)
        from using                          0  (_merge==2)

    matched                            73,719  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       104,025
        from master                   104,025  (_merge==1)
        from using                          0  (_merge==2)

    matched                             6,775  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,388
        from master                     9,388  (_merge==1)
        from using                          0  (_merge==2)

    matched                           101,412  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       106,964
        from master                   106,964  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,836  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        86,248
        from master                    86,248  (_merge==1)
        from using                          0  (_merge==2)

    matched                            24,552  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        62,530
        from master                    62,530  (_merge==1)
        from using                          0  (_merge==2)

    matched                            48,270  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        39,051
        from master                    39,051  (_merge==1)
        from using                          0  (_merge==2)

    matched                            71,749  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        66,393
        from master                    66,393  (_merge==1)
        from using                          0  (_merge==2)

    matched                            44,407  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        15,312
        from master                    15,312  (_merge==1)
        from using                          0  (_merge==2)

    matched                            95,488  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        43,053
        from master                    43,053  (_merge==1)
        from using                          0  (_merge==2)

    matched                            67,747  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        76,583
        from master                    76,583  (_merge==1)
        from using                          0  (_merge==2)

    matched                            34,217  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

. 
. /*
> foreach var in land_r land_u building_all livestock trspt agri non_farm shares fin_other f
> in_gold fin_rec {
> replace `var' = 0 if mi(`var')
> } 
> */
.  
. qui compress

. save "${r_output}\NSS70_All",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> NSS70_All.dta saved

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. replace asset_fin = asset_fin - fin_retire
(41,436 real changes made, 9,388 to missing)

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(40,464 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_other gold f
> in_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1725213    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    3775.014    53973.77          0    9000000
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(1,131 missing values generated)

. gen du_share = durable_other/asset
(1,131 missing values generated)

. gen gl_share = gold / asset
(9,090 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,403    .7669085    .2922743          0          1
    du_share |    107,403    .0714631    .1475181          0          1
    gl_share |     99,444    .1275124    .2326475          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,403   452485181    .7642672   .2991904          0          1
    du_share | 107,403   452485181    .0655324   .1416849          0          1
    gl_share |  99,444   412916692    .1412437   .2469402          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,403  2.0671e+09    .7818741   .2764508          0          1
    du_share | 107,403  2.0671e+09     .065999   .1319788          0          1
    gl_share |  99,444  1.8959e+09    .1234824   .2246801          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,754,453   573,983
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |   -21,695    31,052 1,447,452 1,339,411    50,171    63,913 1,517,281
     p50 |         0         0   452,000   385,000     9,000    25,000   471,000
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |   -21,341    29,400 1,643,910 1,525,683    59,373    64,471 1,713,163
     p50 |         0         0   529,700   455,000    15,000    25,000   552,500
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                    mean         p50
   asset_fin  -21694.978           0
  fin_retire   31051.624           0
asset_non_~n     1447452      452000
 real_estate   1339411.5      385000
durable_ot~r   50170.976        9000
        gold   63912.865       25000
       asset   1517280.8      471000

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +-------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full        mean      p50   delta_~n   delta~50 |
     |-------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   -21694.98        0       -188       -100 |
  2. |  28,317         0    Retirement accounts    31051.63        0         10          . |
  3. | 1528232   478,300   Non-financial assets     1447452   452000         -5         -5 |
  4. | 1441279   407,000            Real estate     1339412   385000         -7         -5 |
  5. |  58,660    11,680          Durable goods    50170.98     9000        -14        -23 |
     |-------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion    63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset     1517281   471000         -4         -6 |
     +-------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,5,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inlist(b12_q1,1,4))), by(HHID)

. egen double fin_other_man = sum(b12_q3*(inrange(b12_q1,1,7)| b12_q1 == 10)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   *Check the manual (man) sum with survey sum
.   count if fin_other > fin_other_man
  0

.   count if fin_other < fin_other_man
  79,065

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(40,464 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_other gold f
> in_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1725213    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    3775.014    53973.77          0    9000000
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(1,131 missing values generated)

. gen du_share = durable_other/asset
(1,131 missing values generated)

. gen gl_share = gold / asset
(9,090 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,403    .7669085    .2922743          0          1
    du_share |    107,403    .0714631    .1475181          0          1
    gl_share |     99,444    .1275124    .2326475          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,403   452485181    .7642672   .2991904          0          1
    du_share | 107,403   452485181    .0655324   .1416849          0          1
    gl_share |  99,444   412916692    .1412437   .2469402          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,403  2.0671e+09    .7818741   .2764508          0          1
    du_share | 107,403  2.0671e+09     .065999   .1319788          0          1
    gl_share |  99,444  1.8959e+09    .1234824   .2246801          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,754,453   573,983
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |     8,533    31,052 1,447,452 1,339,411    50,171    63,913 1,517,281
     p50 |         0         0   452,000   385,000     9,000    25,000   471,000
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |     7,415    29,400 1,643,910 1,525,683    59,373    64,471 1,713,163
     p50 |         0         0   529,700   455,000    15,000    25,000   552,500
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  8532.5633          0
  fin_retire  31051.624          0
asset_non_~n    1447452     452000
 real_estate  1339411.5     385000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset  1517280.8     471000

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   8532.563        0        -65       -100 |
  2. |  28,317         0    Retirement accounts   31051.63        0         10          . |
  3. | 1528232   478,300   Non-financial assets    1447452   452000         -5         -5 |
  4. | 1441279   407,000            Real estate    1339412   385000         -7         -5 |
  5. |  58,660    11,680          Durable goods   50170.98     9000        -14        -23 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset    1517281   471000         -4         -6 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. ****************************************************************************
. * Description: Import NSS70 from Raw Files and save dta to Output Folder
. * Date: Oct 16, 2020
. * Version 1.2
. * Last Editor: Aline
. ****************************************************************************
. 
. ****************************************************************************
. clear 

. clear matrix

. ****************************************************************************
. 
. ****************************************************************************
. * Determine Whose Machine is running the code and set the global directory
. ****************************************************************************
. if "`c(username)'" == "wb308830" local pc = 0

. if "`c(username)'" != "wb308830" local pc = 1

. if `pc' == 0 global root "C:\Users\wb308830\OneDrive - WBG\Documents\TN\Data\NSS 70"

. if `pc' != 0 global root "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\N
> SS70"

. 
. di "$root"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70

. global r_input "${root}\Raw Data & Dictionaries"

. di "${r_input}"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Dictionaries

. global r_output "${root}\Data Output Files"

. 
. ****************************************************************************
. *gen date of survey 
. use "${r_input}\Visit 1_Block 1&2_Identification of sample household and particulars of fi
> eld operations.dta",clear

. gen month = real(substr(Survey_Date,3,2))

. gen year = 2013 //there's 2017 and 2019 should be mistake

. 
. gen date_survey = ym(year,month)

. format date_survey %tmMCY

. 
. keep HHID date_survey

. save "${r_output}\b2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b2.dta saved

. 
. 
. *gen id, wgt (hhwgt, popwgt) b3
. use "${r_input}\Visit 1_Block 3_Household Characteristics.dta",clear

. 
. rename (b3q1 Sector) (hhsize sector)

. //gen hhwgt = MLT 
. gen hhwgt = Weight_SS 

. 
. destring(hhsize),replace
hhsize: all characters numeric; replaced as byte

. gen pwgt = hhwgt * hhsize

. 
. destring(sector), replace
sector: all characters numeric; replaced as byte

. gen urban = sector - 1

. keep HHID hhwgt pwgt hhsize sector urban Weight_SS Weight_SC

. save "${r_output}\b3",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b3.dta saved

. 
. *gender from b4 (4)
. use "${r_input}\Visit 1 _Block 4_Demographic and other particulars of household members.dt
> a",clear

. *Keep head 
. keep if b4q1 == "01" // keep heads only 
(408,795 observations deleted)

. ren b4q5 head_age 

. 
. ren  b4q4 head_gender 

. destring head_gender, replace
head_gender: all characters numeric; replaced as byte

. label define gender 1 "Male" 2 "Female"

. label values head_gender gender 

. gen head_female = (head_gender == 2)*100

. 
. keep HHID head_age head_gender head_female

. save "${r_output}\b4",replace 
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b4.dta saved

. 
. *Asset non_fin： land from b5.1 & b5.2 (rural & urban) srl 99
. use "${r_input}\Visit 1_Block 5pt1_Details of land owned by the household as on 30.06.12.d
> ta",clear

. sum b5_1_6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b5_1_6 |    223,958    630116.4     2835074          0   2.49e+08

. rename State state

. 
. egen double land_r = sum(b5_1_6*(b5_1_1 == "99")), by(HHID)

. egen double land_r_man = sum(b5_1_6*(b5_1_1 != "99")), by(HHID)

. egen double land_r_resid = sum(b5_1_6*(b5_1_1 != "99")*( b5_1_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(156,468 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_r > land_r_man
  0

. count if land_r < land_r_man
  15

. 
. drop land_r

. rename land_r_man land_r 

. 
. keep HHID land_r land_r_resid

. save "${r_output}\b5_1",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_1.dta saved

. 
. use "${r_input}\Visit 1_Block 5pt2_Details of land owned by the household as on 30.06.12.d
> ta",clear

. count if b5_2_6 < 0
  2

. replace b5_2_6 = . if b5_2_6 < 0
(2 real changes made, 2 to missing)

. 
. egen double land_u = sum(b5_2_6*(b5_2_1 == "99")), by(HHID)

. egen double land_u_man = sum(b5_2_6*(b5_2_1 != "99")), by(HHID)

. egen double land_u_resid = sum(b5_2_6*(b5_2_1 != "99")*( b5_2_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(41,892 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_u > land_u_man
  0

. count if land_u < land_u_man
  16

. 
. drop land_u

. rename land_u_man land_u

. 
. keep HHID land_u land_u_resid

. save "${r_output}\b5_2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_2.dta saved

. 
. 
. 
. *Asset non_fin: building and constructions b6 srl 11
. use "${r_input}\Visit 1_Block 6_Buildings and other constructions owned by the household a
> s on 30.06.2012.dta",clear

. sum b6_q6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b6_q6 |    244,737    479786.6     8839515          0   1.85e+09

. 
. egen double building_all = sum(b6_q6*(b6_q3 == "11")), by(HHID)

. egen double building_all_man = sum(b6_q6*(b6_q3 != "11")),  by(HHID)

. 
. egen double building_resid = sum(b6_q6*(b6_q3 == "01")), by(HHID)

. egen double building_dwelling = sum(b6_q6*(inlist(b6_q3,"01","02","03"))), by(HHID)

. 
. egen double building_resid_area = sum(b6_q5*(inlist(b6_q3,"01","02","03"))), by(HHID)

. egen double building_dwelling_area = sum(b6_q5*(b6_q3 == "01")), by(HHID)

. 
. duplicates drop HHID,  force

Duplicates in terms of HHID

(149,298 observations deleted)

. 
. keep HHID building_all* building_resid building_resid_area building_dwelling building_dwel
> ling_area

. 
. *Check the manual (man) sum with survey sum
. count if building_resid > building_all
  2

. count if building_resid > building_all_man
  0

. 
. drop building_all

. ren building_all_man building_all 

. 
. save "${r_output}\b6",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b6.dta saved

. 
. *Asset non_fin: livestock and poultry b7 srl 22 
. use "${r_input}\Visit 1_Block 7_Livestock and poultry owned by the household on 30.06.2012
> .dta",clear

. destring b7_q2,replace
b7_q2: all characters numeric; replaced as byte

. sum b7_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b7_q5 |    176,881    23115.77    42294.12          0    2590000

. 
. egen double livestock = sum(b7_q5*(b7_q2 == 22)), by(HHID)

. egen double livestock_man = sum(b7_q5*(inrange(b7_q2,17,21))), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(132,557 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if livestock > livestock_man
  0

. count if livestock < livestock_man
  14

. 
. drop livestock

. rename livestock_man livestock

. 
. keep HHID livestock

. save "${r_output}\b7",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b7.dta saved

. 
. *Asset non_fin: transport equipment b8: srl 8
. use "${r_input}\Visit 1_Block 8_Transport equipment owned by the household on 30.06.2012.d
> ta",clear

. sum b8_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b8_q5 |    166,428    64309.42      250881          0   2.07e+07

. 
. egen double trspt = sum(b8_q5*(b8_q2 == "08")), by(HHID)

. egen double trspt_man = sum(b8_q5*(b8_q2 != "08")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(94,706 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if trspt > trspt_man
  0

. count if trspt < trspt_man
  9

. 
. drop trspt

. rename trspt_man trspt

. 
. keep HHID trspt

. save "${r_output}\b8",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b8.dta saved

. 
. *Asset non_fin: agricultural machinery and implements b9: srl 8 
. use "${r_input}\Visit 1_Block 9_Agricultural machinery and implements owned by the househo
> ld on 30.06.2012.dta",clear

. sum b9_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b9_q4 |    120,458    7046.966    42346.08         10    7700000

. 
. egen double agri = sum(b9_q4*(b9_q2 == "8")), by(HHID)

. egen double agri_man = sum(b9_q4*(b9_q2 != "8")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(72,196 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if agri > agri_man
  0

. count if agri < agri_man
  2

. 
. drop agri

. rename agri_man agri

. 
. keep HHID agri

. save "${r_output}\b9",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b9.dta saved

. 
. *Asset non_fin: non-farm business equipment b10 srl 15
. use "${r_input}\Visit 1_Block 10_Non-farm business equipment owned by the household as on 
> 30.06.2012.dta",clear

. destring b10_q2,replace
b10_q2: all characters numeric; replaced as byte

. sum b10_q3 //issue with raw-data.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b10_q3 |        119           0           0          0          0

. 
. egen double non_farm = sum(b10_q3*(b10_q2 == 15)), by(HHID)

. egen double non_farm_man = sum(b10_q3*inrange(b10_q2,12,14)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(60,778 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if non_farm > non_farm_man
  0

. count if non_farm < non_farm_man
  0

. 
. drop non_farm_man

. keep HHID non_farm

. save "${r_output}\b10",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b10.dta saved

. 
. *Asset fin: shares & debentures b11 
. use "${r_input}\Visit 1_Block 11_ Shares and debentures owned by the household in co-opera
> tive  societies & companies as on 30.06.2012 .dta",clear

. 
.  *Check the manual (man) sum with survey sum
.   preserve

.   egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

.   egen double shares_man = sum(b11_q6*(b11_q1 != "5")), by(HHID)

.   duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

.   count if shares > shares_man
  0

.   count if shares < shares_man
  0

.   restore 

. 
. sum b11_q6 if b11_q1 != "5" 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b11_q6 |      3,931    44989.44    324279.8     -50000   1.00e+07

. replace b11_q6 = . if b11_q6<0 //filter out the non-negative colums. 
(23 real changes made, 23 to missing)

. egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

. 
. keep HHID shares

. save "${r_output}\b11",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b11.dta saved

. 
. *Asset fin: other financial assets b12 srl 11 
. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,5,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inrange(b12_q1,1,4))), by(HHID)

. egen double fin_other_man = sum(b12_q3*(inrange(b12_q1,1,7)| b12_q1 == 10)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   *Check the manual (man) sum with survey sum
.   count if fin_other > fin_other_man
  0

.   count if fin_other < fin_other_man
  34,106

. 
.   /*
> drop fin_other 
> ren fin_other_man fin_other
> */
. 
. keep HHID fin_other gold fin_retire

. save "${r_output}\b12",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b12.dta saved

. 
. *Asset fin: amount receivable b13 (mortgage srl 1, total srl 7)
. use "${r_input}\Visit 1_Block 13_Amount receivable by the household against different head
> s as on 30.06.2012.dta",clear

. sum b13_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b13_q4 |     13,807    63848.05    419515.8          0   2.00e+07

. 
. egen double fin_rec = sum(b13_q4*(b13_q2 == "7")), by(HHID)

. egen double fin_rec_man = sum(b13_q4*(b13_q2 != "7")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(7,033 observations deleted)

. 
.   *Check the manual (man) sum with survey sum
.   count if fin_rec > fin_rec_man
  0

.   count if fin_rec < fin_rec_man
  2

.  
. drop fin_rec

. ren fin_rec_man fin_rec

. keep HHID fin_rec

. save "${r_output}\b13",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b13.dta saved

. 
. *Debt: cash loands payable b14: Type of loan(8) Purpose of loan (11) Type of mortgage(13) 
> , srl 99 (total)
. use "${r_input}\Visit 1_Block 14",clear

. drop if b14_q1 == "99" //drop the total amount
(73,266 observations deleted)

. 
. *debt
. gen debt = b14_q17
(47,671 missing values generated)

. gen b14 = debt
(47,671 missing values generated)

. 
. *loan purpose
. gen loan_purpose = b14_q11
(4 missing values generated)

. gen hous_loan = (b14_q11 == "11")*debt
(47,671 missing values generated)

. 
. *credit agency
. gen credit_agency = b14_q6
(1 missing value generated)

. 
. destring(b14_q6),replace
b14_q6: all characters numeric; replaced as byte
(1 missing value generated)

. gen credit_formal = (!inrange(b14_q6,12,17)& b14_q6!=9)*debt
(47,671 missing values generated)

. 
. *mortgage
. gen mortgage_type = b14_q13
(7 missing values generated)

. gen has_mortgage =  (b14_q13 != "4")*debt
(47,671 missing values generated)

. 
. *borrowed amount
. gen br_amount = b14_q5
(1 missing value generated)

. 
. *aggregate at household level. *** When you collapse, check if any HH has two housing loan
> s - we don't want to combine them. In fact we should try and do all this in file 03_Mortga
> ge so we can keep file 01 clean while we play around with this data
. collapse (sum) hous_loan (sum) credit_formal (sum) has_mortgage  (sum) br_amount (sum) deb
> t,by(HHID)

. label var hous_loan "loan with purpose on housing"

. label var has_mortgage "loan with mortgage"

. 
. save "${r_output}\b14",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b14.dta saved

. 
. *Debt: kind of loan payable b15 col 11: housing 11
. use "${r_input}\Visit 1_Block 15_kind loans payable by the household.dta",replace

. save "${r_output}\b15",replace //late housing info
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b15.dta saved

. 
. 
. 
. *******merge to master data******************************
. use "${r_output}\b2",clear

. local flist "b3 b14 b13 b12 b11 b10 b9 b8 b7 b6 b5_1 b5_2 b4"

. 
. foreach f of local flist{
  2. merge 1:1 HHID using "${r_output}/`f'"
  3. drop _merge
  4. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        37,081
        from master                    37,081  (_merge==1)
        from using                          0  (_merge==2)

    matched                            73,719  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       104,025
        from master                   104,025  (_merge==1)
        from using                          0  (_merge==2)

    matched                             6,775  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,388
        from master                     9,388  (_merge==1)
        from using                          0  (_merge==2)

    matched                           101,412  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       106,964
        from master                   106,964  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,836  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        86,248
        from master                    86,248  (_merge==1)
        from using                          0  (_merge==2)

    matched                            24,552  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        62,530
        from master                    62,530  (_merge==1)
        from using                          0  (_merge==2)

    matched                            48,270  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        39,051
        from master                    39,051  (_merge==1)
        from using                          0  (_merge==2)

    matched                            71,749  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        66,393
        from master                    66,393  (_merge==1)
        from using                          0  (_merge==2)

    matched                            44,407  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        15,312
        from master                    15,312  (_merge==1)
        from using                          0  (_merge==2)

    matched                            95,488  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        43,053
        from master                    43,053  (_merge==1)
        from using                          0  (_merge==2)

    matched                            67,747  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        76,583
        from master                    76,583  (_merge==1)
        from using                          0  (_merge==2)

    matched                            34,217  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

. 
. /*
> foreach var in land_r land_u building_all livestock trspt agri non_farm shares fin_other f
> in_gold fin_rec {
> replace `var' = 0 if mi(`var')
> } 
> */
.  
. qui compress

. save "${r_output}\NSS70_All",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> NSS70_All.dta saved

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(40,216 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_other gold f
> in_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1743216    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    23443.73    176767.7          0   3.25e+07
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(719 missing values generated)

. gen du_share = durable_other/asset
(719 missing values generated)

. gen gl_share = gold / asset
(8,678 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,815    .7558634    .2951139          0          1
    du_share |    107,815    .0674834    .1362249          0          1
    gl_share |     99,856    .1191411    .2145405          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,815   454432458    .7543921   .3021585          0          1
    du_share | 107,815   454432458    .0619097   .1306105          0          1
    gl_share |  99,856   414863969    .1325237   .2295046          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,815  2.0714e+09    .7738841   .2783088          0          1
    du_share | 107,815  2.0714e+09    .0632362   .1234123          0          1
    gl_share |  99,856  1.9002e+09    .1169311     .20964          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,772,765   581,440
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    23,691    31,052 1,447,452 1,339,411    50,171    63,913 1,532,439
     p50 |     1,200         0   452,000   385,000     9,000    25,000   478,825
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    21,508    29,400 1,643,910 1,525,683    59,373    64,471 1,727,256
     p50 |     1,300         0   529,700   455,000    15,000    25,000   557,000
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  23691.231       1200
  fin_retire  31051.624          0
asset_non_~n    1447452     452000
 real_estate  1339411.5     385000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset  1532439.5     478825

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   23691.23     1200         -4        -11 |
  2. |  28,317         0    Retirement accounts   31051.63        0         10          . |
  3. | 1528232   478,300   Non-financial assets    1447452   452000         -5         -5 |
  4. | 1441279   407,000            Real estate    1339412   385000         -7         -5 |
  5. |  58,660    11,680          Durable goods   50170.98     9000        -14        -23 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset    1532440   478825         -3         -5 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. ****************************************************************************
. * Description: Import NSS70 from Raw Files and save dta to Output Folder
. * Date: Oct 16, 2020
. * Version 1.2
. * Last Editor: Aline
. ****************************************************************************
. 
. ****************************************************************************
. clear 

. clear matrix

. ****************************************************************************
. 
. ****************************************************************************
. * Determine Whose Machine is running the code and set the global directory
. ****************************************************************************
. if "`c(username)'" == "wb308830" local pc = 0

. if "`c(username)'" != "wb308830" local pc = 1

. if `pc' == 0 global root "C:\Users\wb308830\OneDrive - WBG\Documents\TN\Data\NSS 70"

. if `pc' != 0 global root "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\N
> SS70"

. 
. di "$root"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70

. global r_input "${root}\Raw Data & Dictionaries"

. di "${r_input}"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Dictionaries

. global r_output "${root}\Data Output Files"

. 
. ****************************************************************************
. *gen date of survey 
. use "${r_input}\Visit 1_Block 1&2_Identification of sample household and particulars of fi
> eld operations.dta",clear

. gen month = real(substr(Survey_Date,3,2))

. gen year = 2013 //there's 2017 and 2019 should be mistake

. 
. gen date_survey = ym(year,month)

. format date_survey %tmMCY

. 
. keep HHID date_survey

. save "${r_output}\b2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b2.dta saved

. 
. 
. *gen id, wgt (hhwgt, popwgt) b3
. use "${r_input}\Visit 1_Block 3_Household Characteristics.dta",clear

. 
. rename (b3q1 Sector) (hhsize sector)

. //gen hhwgt = MLT 
. gen hhwgt = Weight_SS 

. 
. destring(hhsize),replace
hhsize: all characters numeric; replaced as byte

. gen pwgt = hhwgt * hhsize

. 
. destring(sector), replace
sector: all characters numeric; replaced as byte

. gen urban = sector - 1

. keep HHID hhwgt pwgt hhsize sector urban Weight_SS Weight_SC

. save "${r_output}\b3",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b3.dta saved

. 
. *gender from b4 (4)
. use "${r_input}\Visit 1 _Block 4_Demographic and other particulars of household members.dt
> a",clear

. *Keep head 
. keep if b4q1 == "01" // keep heads only 
(408,795 observations deleted)

. ren b4q5 head_age 

. 
. ren  b4q4 head_gender 

. destring head_gender, replace
head_gender: all characters numeric; replaced as byte

. label define gender 1 "Male" 2 "Female"

. label values head_gender gender 

. gen head_female = (head_gender == 2)*100

. 
. keep HHID head_age head_gender head_female

. save "${r_output}\b4",replace 
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b4.dta saved

. 
. *Asset non_fin： land from b5.1 & b5.2 (rural & urban) srl 99
. use "${r_input}\Visit 1_Block 5pt1_Details of land owned by the household as on 30.06.12.d
> ta",clear

. sum b5_1_6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b5_1_6 |    223,958    630116.4     2835074          0   2.49e+08

. rename State state

. 
. egen double land_r = sum(b5_1_6*(b5_1_1 == "99")), by(HHID)

. egen double land_r_man = sum(b5_1_6*(b5_1_1 != "99")), by(HHID)

. egen double land_r_resid = sum(b5_1_6*(b5_1_1 != "99")*( b5_1_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(156,468 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_r > land_r_man
  0

. count if land_r < land_r_man
  15

. 
. drop land_r

. rename land_r_man land_r 

. 
. keep HHID land_r land_r_resid

. save "${r_output}\b5_1",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_1.dta saved

. 
. use "${r_input}\Visit 1_Block 5pt2_Details of land owned by the household as on 30.06.12.d
> ta",clear

. count if b5_2_6 < 0
  2

. replace b5_2_6 = . if b5_2_6 < 0
(2 real changes made, 2 to missing)

. 
. egen double land_u = sum(b5_2_6*(b5_2_1 == "99")), by(HHID)

. egen double land_u_man = sum(b5_2_6*(b5_2_1 != "99")), by(HHID)

. egen double land_u_resid = sum(b5_2_6*(b5_2_1 != "99")*( b5_2_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(41,892 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_u > land_u_man
  0

. count if land_u < land_u_man
  16

. 
. drop land_u

. rename land_u_man land_u

. 
. keep HHID land_u land_u_resid

. save "${r_output}\b5_2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_2.dta saved

. 
. 
. 
. *Asset non_fin: building and constructions b6 srl 11
. use "${r_input}\Visit 1_Block 6_Buildings and other constructions owned by the household a
> s on 30.06.2012.dta",clear

. sum b6_q6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b6_q6 |    244,737    479786.6     8839515          0   1.85e+09

. 
. egen double building_all = sum(b6_q6*(b6_q3 == "11")), by(HHID)

. egen double building_all_man = sum(b6_q6*(b6_q3 != "11")),  by(HHID)

. 
. egen double building_resid = sum(b6_q6*(b6_q3 == "01")), by(HHID)

. egen double building_dwelling = sum(b6_q6*(inlist(b6_q3,"01","02","03"))), by(HHID)

. 
. egen double building_resid_area = sum(b6_q5*(inlist(b6_q3,"01","02","03"))), by(HHID)

. egen double building_dwelling_area = sum(b6_q5*(b6_q3 == "01")), by(HHID)

. 
. duplicates drop HHID,  force

Duplicates in terms of HHID

(149,298 observations deleted)

. 
. keep HHID building_all* building_resid building_resid_area building_dwelling building_dwel
> ling_area

. 
. *Check the manual (man) sum with survey sum
. count if building_resid > building_all
  2

. count if building_resid > building_all_man
  0

. 
. drop building_all

. ren building_all_man building_all 

. 
. save "${r_output}\b6",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b6.dta saved

. 
. *Asset non_fin: livestock and poultry b7 srl 22 
. use "${r_input}\Visit 1_Block 7_Livestock and poultry owned by the household on 30.06.2012
> .dta",clear

. destring b7_q2,replace
b7_q2: all characters numeric; replaced as byte

. sum b7_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b7_q5 |    176,881    23115.77    42294.12          0    2590000

. 
. egen double livestock = sum(b7_q5*(b7_q2 == 22)), by(HHID)

. egen double livestock_man = sum(b7_q5*(inrange(b7_q2,17,21))), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(132,557 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if livestock > livestock_man
  0

. count if livestock < livestock_man
  14

. 
. drop livestock

. rename livestock_man livestock

. 
. keep HHID livestock

. save "${r_output}\b7",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b7.dta saved

. 
. *Asset non_fin: transport equipment b8: srl 8
. use "${r_input}\Visit 1_Block 8_Transport equipment owned by the household on 30.06.2012.d
> ta",clear

. sum b8_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b8_q5 |    166,428    64309.42      250881          0   2.07e+07

. 
. egen double trspt = sum(b8_q5*(b8_q2 == "08")), by(HHID)

. egen double trspt_man = sum(b8_q5*(b8_q2 != "08")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(94,706 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if trspt > trspt_man
  0

. count if trspt < trspt_man
  9

. 
. drop trspt

. rename trspt_man trspt

. 
. keep HHID trspt

. save "${r_output}\b8",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b8.dta saved

. 
. *Asset non_fin: agricultural machinery and implements b9: srl 8 
. use "${r_input}\Visit 1_Block 9_Agricultural machinery and implements owned by the househo
> ld on 30.06.2012.dta",clear

. sum b9_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b9_q4 |    120,458    7046.966    42346.08         10    7700000

. 
. egen double agri = sum(b9_q4*(b9_q2 == "8")), by(HHID)

. egen double agri_man = sum(b9_q4*(b9_q2 != "8")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(72,196 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if agri > agri_man
  0

. count if agri < agri_man
  2

. 
. drop agri

. rename agri_man agri

. 
. keep HHID agri

. save "${r_output}\b9",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b9.dta saved

. 
. *Asset non_fin: non-farm business equipment b10 srl 15
. use "${r_input}\Visit 1_Block 10_Non-farm business equipment owned by the household as on 
> 30.06.2012.dta",clear

. destring b10_q2,replace
b10_q2: all characters numeric; replaced as byte

. sum b10_q3 //issue with raw-data.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b10_q3 |        119           0           0          0          0

. 
. egen double non_farm = sum(b10_q3*(b10_q2 == 15)), by(HHID)

. egen double non_farm_man = sum(b10_q3*inrange(b10_q2,12,14)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(60,778 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if non_farm > non_farm_man
  0

. count if non_farm < non_farm_man
  0

. 
. drop non_farm_man

. keep HHID non_farm

. save "${r_output}\b10",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b10.dta saved

. 
. *Asset fin: shares & debentures b11 
. use "${r_input}\Visit 1_Block 11_ Shares and debentures owned by the household in co-opera
> tive  societies & companies as on 30.06.2012 .dta",clear

. 
.  *Check the manual (man) sum with survey sum
.   preserve

.   egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

.   egen double shares_man = sum(b11_q6*(b11_q1 != "5")), by(HHID)

.   duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

.   count if shares > shares_man
  0

.   count if shares < shares_man
  0

.   restore 

. 
. sum b11_q6 if b11_q1 != "5" 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b11_q6 |      3,931    44989.44    324279.8     -50000   1.00e+07

. replace b11_q6 = . if b11_q6<0 //filter out the non-negative colums. 
(23 real changes made, 23 to missing)

. egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

. 
. keep HHID shares

. save "${r_output}\b11",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b11.dta saved

. 
. *Asset fin: other financial assets b12 srl 11 
. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inrange(b12_q1,1,5))), by(HHID)

. 
. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   /*
> drop fin_other 
> ren fin_other_man fin_other
> */
. 
. keep HHID fin_other gold fin_retire

. save "${r_output}\b12",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b12.dta saved

. 
. *Asset fin: amount receivable b13 (mortgage srl 1, total srl 7)
. use "${r_input}\Visit 1_Block 13_Amount receivable by the household against different head
> s as on 30.06.2012.dta",clear

. sum b13_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b13_q4 |     13,807    63848.05    419515.8          0   2.00e+07

. 
. egen double fin_rec = sum(b13_q4*(b13_q2 == "7")), by(HHID)

. egen double fin_rec_man = sum(b13_q4*(b13_q2 != "7")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(7,033 observations deleted)

. 
.   *Check the manual (man) sum with survey sum
.   count if fin_rec > fin_rec_man
  0

.   count if fin_rec < fin_rec_man
  2

.  
. drop fin_rec

. ren fin_rec_man fin_rec

. keep HHID fin_rec

. save "${r_output}\b13",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b13.dta saved

. 
. *Debt: cash loands payable b14: Type of loan(8) Purpose of loan (11) Type of mortgage(13) 
> , srl 99 (total)
. use "${r_input}\Visit 1_Block 14",clear

. drop if b14_q1 == "99" //drop the total amount
(73,266 observations deleted)

. 
. *debt
. gen debt = b14_q17
(47,671 missing values generated)

. gen b14 = debt
(47,671 missing values generated)

. 
. *loan purpose
. gen loan_purpose = b14_q11
(4 missing values generated)

. gen hous_loan = (b14_q11 == "11")*debt
(47,671 missing values generated)

. 
. *credit agency
. gen credit_agency = b14_q6
(1 missing value generated)

. 
. destring(b14_q6),replace
b14_q6: all characters numeric; replaced as byte
(1 missing value generated)

. gen credit_formal = (!inrange(b14_q6,12,17)& b14_q6!=9)*debt
(47,671 missing values generated)

. 
. *mortgage
. gen mortgage_type = b14_q13
(7 missing values generated)

. gen has_mortgage =  (b14_q13 != "4")*debt
(47,671 missing values generated)

. 
. *borrowed amount
. gen br_amount = b14_q5
(1 missing value generated)

. 
. *aggregate at household level. *** When you collapse, check if any HH has two housing loan
> s - we don't want to combine them. In fact we should try and do all this in file 03_Mortga
> ge so we can keep file 01 clean while we play around with this data
. collapse (sum) hous_loan (sum) credit_formal (sum) has_mortgage  (sum) br_amount (sum) deb
> t,by(HHID)

. label var hous_loan "loan with purpose on housing"

. label var has_mortgage "loan with mortgage"

. 
. save "${r_output}\b14",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b14.dta saved

. 
. *Debt: kind of loan payable b15 col 11: housing 11
. use "${r_input}\Visit 1_Block 15_kind loans payable by the household.dta",replace

. save "${r_output}\b15",replace //late housing info
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b15.dta saved

. 
. 
. 
. *******merge to master data******************************
. use "${r_output}\b2",clear

. local flist "b3 b14 b13 b12 b11 b10 b9 b8 b7 b6 b5_1 b5_2 b4"

. 
. foreach f of local flist{
  2. merge 1:1 HHID using "${r_output}/`f'"
  3. drop _merge
  4. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        37,081
        from master                    37,081  (_merge==1)
        from using                          0  (_merge==2)

    matched                            73,719  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       104,025
        from master                   104,025  (_merge==1)
        from using                          0  (_merge==2)

    matched                             6,775  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,388
        from master                     9,388  (_merge==1)
        from using                          0  (_merge==2)

    matched                           101,412  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       106,964
        from master                   106,964  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,836  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        86,248
        from master                    86,248  (_merge==1)
        from using                          0  (_merge==2)

    matched                            24,552  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        62,530
        from master                    62,530  (_merge==1)
        from using                          0  (_merge==2)

    matched                            48,270  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        39,051
        from master                    39,051  (_merge==1)
        from using                          0  (_merge==2)

    matched                            71,749  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        66,393
        from master                    66,393  (_merge==1)
        from using                          0  (_merge==2)

    matched                            44,407  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        15,312
        from master                    15,312  (_merge==1)
        from using                          0  (_merge==2)

    matched                            95,488  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        43,053
        from master                    43,053  (_merge==1)
        from using                          0  (_merge==2)

    matched                            67,747  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        76,583
        from master                    76,583  (_merge==1)
        from using                          0  (_merge==2)

    matched                            34,217  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

. 
. /*
> foreach var in land_r land_u building_all livestock trspt agri non_farm shares fin_other f
> in_gold fin_rec {
> replace `var' = 0 if mi(`var')
> } 
> */
.  
. qui compress

. save "${r_output}\NSS70_All",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> NSS70_All.dta saved

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(40,216 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_other gold f
> in_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1743325    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(719 missing values generated)

. gen du_share = durable_other/asset
(719 missing values generated)

. gen gl_share = gold / asset
(8,678 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,815    .7558262    .2951223          0          1
    du_share |    107,815    .0674781     .136221          0          1
    gl_share |     99,856     .119122    .2145012          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,815   454432458    .7543695   .3021585          0          1
    du_share | 107,815   454432458    .0619051   .1306082          0          1
    gl_share |  99,856   414863969    .1325032   .2294712          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,815  2.0714e+09     .773865   .2783108          0          1
    du_share | 107,815  2.0714e+09     .063232   .1234101          0          1
    gl_share |  99,856  1.9002e+09    .1169122   .2096048          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,772,877   581,485
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    23,776    30,958 1,447,452 1,339,411    50,171    63,913 1,532,524
     p50 |     1,200         0   452,000   385,000     9,000    25,000   478,825
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    21,578    29,323 1,643,910 1,525,683    59,373    64,471 1,727,327
     p50 |     1,300         0   529,700   455,000    15,000    25,000   557,000
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  23775.776       1200
  fin_retire  30958.251          0
asset_non_~n    1447452     452000
 real_estate  1339411.5     385000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset    1532524     478825

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   23775.78     1200         -4        -11 |
  2. |  28,317         0    Retirement accounts   30958.25        0          9          . |
  3. | 1528232   478,300   Non-financial assets    1447452   452000         -5         -5 |
  4. | 1441279   407,000            Real estate    1339412   385000         -7         -5 |
  5. |  58,660    11,680          Durable goods   50170.98     9000        -14        -23 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset    1532524   478825         -3         -5 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. ****************************************************************************
. * Description: Import NSS70 from Raw Files and save dta to Output Folder
. * Date: Oct 16, 2020
. * Version 1.2
. * Last Editor: Aline
. ****************************************************************************
. 
. ****************************************************************************
. clear 

. clear matrix

. ****************************************************************************
. 
. ****************************************************************************
. * Determine Whose Machine is running the code and set the global directory
. ****************************************************************************
. if "`c(username)'" == "wb308830" local pc = 0

. if "`c(username)'" != "wb308830" local pc = 1

. if `pc' == 0 global root "C:\Users\wb308830\OneDrive - WBG\Documents\TN\Data\NSS 70"

. if `pc' != 0 global root "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\N
> SS70"

. 
. di "$root"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70

. global r_input "${root}\Raw Data & Dictionaries"

. di "${r_input}"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Dictionaries

. global r_output "${root}\Data Output Files"

. 
. ****************************************************************************
. *gen date of survey 
. use "${r_input}\Visit 1_Block 1&2_Identification of sample household and particulars of fi
> eld operations.dta",clear

. gen month = real(substr(Survey_Date,3,2))

. gen year = 2013 //there's 2017 and 2019 should be mistake

. 
. gen date_survey = ym(year,month)

. format date_survey %tmMCY

. 
. keep HHID date_survey

. save "${r_output}\b2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b2.dta saved

. 
. 
. *gen id, wgt (hhwgt, popwgt) b3
. use "${r_input}\Visit 1_Block 3_Household Characteristics.dta",clear

. 
. rename (b3q1 Sector) (hhsize sector)

. //gen hhwgt = MLT 
. gen hhwgt = Weight_SS 

. 
. destring(hhsize),replace
hhsize: all characters numeric; replaced as byte

. gen pwgt = hhwgt * hhsize

. 
. destring(sector), replace
sector: all characters numeric; replaced as byte

. gen urban = sector - 1

. keep HHID hhwgt pwgt hhsize sector urban Weight_SS Weight_SC

. save "${r_output}\b3",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b3.dta saved

. 
. *gender from b4 (4)
. use "${r_input}\Visit 1 _Block 4_Demographic and other particulars of household members.dt
> a",clear

. *Keep head 
. keep if b4q1 == "01" // keep heads only 
(408,795 observations deleted)

. ren b4q5 head_age 

. 
. ren  b4q4 head_gender 

. destring head_gender, replace
head_gender: all characters numeric; replaced as byte

. label define gender 1 "Male" 2 "Female"

. label values head_gender gender 

. gen head_female = (head_gender == 2)*100

. 
. keep HHID head_age head_gender head_female

. save "${r_output}\b4",replace 
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b4.dta saved

. 
. *Asset non_fin： land from b5.1 & b5.2 (rural & urban) srl 99
. use "${r_input}\Visit 1_Block 5pt1_Details of land owned by the household as on 30.06.12.d
> ta",clear

. sum b5_1_6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b5_1_6 |    223,958    630116.4     2835074          0   2.49e+08

. rename State state

. 
. egen double land_r = sum(b5_1_6*(b5_1_1 == "99")), by(HHID)

. egen double land_r_man = sum(b5_1_6*(b5_1_1 != "99")), by(HHID)

. egen double land_r_resid = sum(b5_1_6*(b5_1_1 != "99")*( b5_1_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(156,468 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_r > land_r_man
  0

. count if land_r < land_r_man
  15

. 
. drop land_r

. rename land_r_man land_r 

. 
. keep HHID land_r land_r_resid

. save "${r_output}\b5_1",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_1.dta saved

. 
. use "${r_input}\Visit 1_Block 5pt2_Details of land owned by the household as on 30.06.12.d
> ta",clear

. count if b5_2_6 < 0
  2

. replace b5_2_6 = . if b5_2_6 < 0
(2 real changes made, 2 to missing)

. 
. egen double land_u = sum(b5_2_6*(b5_2_1 == "99")), by(HHID)

. egen double land_u_man = sum(b5_2_6*(b5_2_1 != "99")), by(HHID)

. egen double land_u_resid = sum(b5_2_6*(b5_2_1 != "99")*( b5_2_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(41,892 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_u > land_u_man
  0

. count if land_u < land_u_man
  16

. 
. drop land_u

. rename land_u_man land_u

. 
. keep HHID land_u land_u_resid

. save "${r_output}\b5_2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_2.dta saved

. 
. 
. 
. *Asset non_fin: building and constructions b6 srl 11
. use "${r_input}\Visit 1_Block 6_Buildings and other constructions owned by the household a
> s on 30.06.2012.dta",clear

. sum b6_q6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b6_q6 |    244,737    479786.6     8839515          0   1.85e+09

. 
. egen double building_all = sum(b6_q6*(b6_q3 == "11")), by(HHID)

. egen double building_all_man = sum(b6_q6*(b6_q3 != "11")),  by(HHID)

. 
. egen double building_resid = sum(b6_q6*(b6_q3 == "01")), by(HHID)

. egen double building_dwelling = sum(b6_q6*(inlist(b6_q3,"01","02","03"))), by(HHID)

. 
. egen double building_resid_area = sum(b6_q5*(inlist(b6_q3,"01","02","03"))), by(HHID)

. egen double building_dwelling_area = sum(b6_q5*(b6_q3 == "01")), by(HHID)

. 
. duplicates drop HHID,  force

Duplicates in terms of HHID

(149,298 observations deleted)

. 
. keep HHID building_all* building_resid building_resid_area building_dwelling building_dwel
> ling_area

. 
. *Check the manual (man) sum with survey sum
. count if building_resid > building_all
  2

. count if building_resid > building_all_man
  0

. 
. drop building_all

. ren building_all_man building_all 

. 
. save "${r_output}\b6",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b6.dta saved

. 
. *Asset non_fin: livestock and poultry b7 srl 22 
. use "${r_input}\Visit 1_Block 7_Livestock and poultry owned by the household on 30.06.2012
> .dta",clear

. destring b7_q2,replace
b7_q2: all characters numeric; replaced as byte

. sum b7_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b7_q5 |    176,881    23115.77    42294.12          0    2590000

. 
. egen double livestock = sum(b7_q5*(b7_q2 == 22)), by(HHID)

. egen double livestock_man = sum(b7_q5*(inrange(b7_q2,17,21))), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(132,557 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if livestock > livestock_man
  0

. count if livestock < livestock_man
  14

. 
. drop livestock

. rename livestock_man livestock

. 
. keep HHID livestock

. save "${r_output}\b7",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b7.dta saved

. 
. *Asset non_fin: transport equipment b8: srl 8
. use "${r_input}\Visit 1_Block 8_Transport equipment owned by the household on 30.06.2012.d
> ta",clear

. sum b8_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b8_q5 |    166,428    64309.42      250881          0   2.07e+07

. 
. egen double trspt = sum(b8_q5*(b8_q2 == "08")), by(HHID)

. egen double trspt_man = sum(b8_q5*(b8_q2 != "08")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(94,706 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if trspt > trspt_man
  0

. count if trspt < trspt_man
  9

. 
. drop trspt

. rename trspt_man trspt

. 
. keep HHID trspt

. save "${r_output}\b8",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b8.dta saved

. 
. *Asset non_fin: agricultural machinery and implements b9: srl 8 
. use "${r_input}\Visit 1_Block 9_Agricultural machinery and implements owned by the househo
> ld on 30.06.2012.dta",clear

. sum b9_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b9_q4 |    120,458    7046.966    42346.08         10    7700000

. 
. egen double agri = sum(b9_q4*(b9_q2 == "8")), by(HHID)

. egen double agri_man = sum(b9_q4*(b9_q2 != "8")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(72,196 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if agri > agri_man
  0

. count if agri < agri_man
  2

. 
. drop agri

. rename agri_man agri

. 
. keep HHID agri

. save "${r_output}\b9",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b9.dta saved

. 
. *Asset non_fin: non-farm business equipment b10 srl 15
. use "${r_input}\Visit 1_Block 10_Non-farm business equipment owned by the household as on 
> 30.06.2012.dta",clear

. destring b10_q2,replace
b10_q2: all characters numeric; replaced as byte

. sum b10_q3 //issue with raw-data.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b10_q3 |        119           0           0          0          0

. 
. egen double non_farm = sum(b10_q3*(b10_q2 == 15)), by(HHID)

. egen double non_farm_man = sum(b10_q3*inrange(b10_q2,12,14)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(60,778 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if non_farm > non_farm_man
  0

. count if non_farm < non_farm_man
  0

. 
. drop non_farm_man

. keep HHID non_farm

. save "${r_output}\b10",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b10.dta saved

. 
. *Asset fin: shares & debentures b11 
. use "${r_input}\Visit 1_Block 11_ Shares and debentures owned by the household in co-opera
> tive  societies & companies as on 30.06.2012 .dta",clear

. 
.  *Check the manual (man) sum with survey sum
.   preserve

.   egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

.   egen double shares_man = sum(b11_q6*(b11_q1 != "5")), by(HHID)

.   duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

.   count if shares > shares_man
  0

.   count if shares < shares_man
  0

.   restore 

. 
. sum b11_q6 if b11_q1 != "5" 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b11_q6 |      3,931    44989.44    324279.8     -50000   1.00e+07

. replace b11_q6 = . if b11_q6<0 //filter out the non-negative colums. 
(23 real changes made, 23 to missing)

. egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

. 
. keep HHID shares

. save "${r_output}\b11",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b11.dta saved

. 
. *Asset fin: other financial assets b12 srl 11 
. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,5,6))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inrange(b12_q1,1,4) | b12_q1 == 7 )), by(HHID)

. 
. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   /*
> drop fin_other 
> ren fin_other_man fin_other
> */
. 
. keep HHID fin_other gold fin_retire

. save "${r_output}\b12",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b12.dta saved

. 
. *Asset fin: amount receivable b13 (mortgage srl 1, total srl 7)
. use "${r_input}\Visit 1_Block 13_Amount receivable by the household against different head
> s as on 30.06.2012.dta",clear

. sum b13_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b13_q4 |     13,807    63848.05    419515.8          0   2.00e+07

. 
. egen double fin_rec = sum(b13_q4*(b13_q2 == "7")), by(HHID)

. egen double fin_rec_man = sum(b13_q4*(b13_q2 != "7")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(7,033 observations deleted)

. 
.   *Check the manual (man) sum with survey sum
.   count if fin_rec > fin_rec_man
  0

.   count if fin_rec < fin_rec_man
  2

.  
. drop fin_rec

. ren fin_rec_man fin_rec

. keep HHID fin_rec

. save "${r_output}\b13",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b13.dta saved

. 
. *Debt: cash loands payable b14: Type of loan(8) Purpose of loan (11) Type of mortgage(13) 
> , srl 99 (total)
. use "${r_input}\Visit 1_Block 14",clear

. drop if b14_q1 == "99" //drop the total amount
(73,266 observations deleted)

. 
. *debt
. gen debt = b14_q17
(47,671 missing values generated)

. gen b14 = debt
(47,671 missing values generated)

. 
. *loan purpose
. gen loan_purpose = b14_q11
(4 missing values generated)

. gen hous_loan = (b14_q11 == "11")*debt
(47,671 missing values generated)

. 
. *credit agency
. gen credit_agency = b14_q6
(1 missing value generated)

. 
. destring(b14_q6),replace
b14_q6: all characters numeric; replaced as byte
(1 missing value generated)

. gen credit_formal = (!inrange(b14_q6,12,17)& b14_q6!=9)*debt
(47,671 missing values generated)

. 
. *mortgage
. gen mortgage_type = b14_q13
(7 missing values generated)

. gen has_mortgage =  (b14_q13 != "4")*debt
(47,671 missing values generated)

. 
. *borrowed amount
. gen br_amount = b14_q5
(1 missing value generated)

. 
. *aggregate at household level. *** When you collapse, check if any HH has two housing loan
> s - we don't want to combine them. In fact we should try and do all this in file 03_Mortga
> ge so we can keep file 01 clean while we play around with this data
. collapse (sum) hous_loan (sum) credit_formal (sum) has_mortgage  (sum) br_amount (sum) deb
> t,by(HHID)

. label var hous_loan "loan with purpose on housing"

. label var has_mortgage "loan with mortgage"

. 
. save "${r_output}\b14",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b14.dta saved

. 
. *Debt: kind of loan payable b15 col 11: housing 11
. use "${r_input}\Visit 1_Block 15_kind loans payable by the household.dta",replace

. save "${r_output}\b15",replace //late housing info
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b15.dta saved

. 
. 
. 
. *******merge to master data******************************
. use "${r_output}\b2",clear

. local flist "b3 b14 b13 b12 b11 b10 b9 b8 b7 b6 b5_1 b5_2 b4"

. 
. foreach f of local flist{
  2. merge 1:1 HHID using "${r_output}/`f'"
  3. drop _merge
  4. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        37,081
        from master                    37,081  (_merge==1)
        from using                          0  (_merge==2)

    matched                            73,719  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       104,025
        from master                   104,025  (_merge==1)
        from using                          0  (_merge==2)

    matched                             6,775  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,388
        from master                     9,388  (_merge==1)
        from using                          0  (_merge==2)

    matched                           101,412  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       106,964
        from master                   106,964  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,836  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        86,248
        from master                    86,248  (_merge==1)
        from using                          0  (_merge==2)

    matched                            24,552  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        62,530
        from master                    62,530  (_merge==1)
        from using                          0  (_merge==2)

    matched                            48,270  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        39,051
        from master                    39,051  (_merge==1)
        from using                          0  (_merge==2)

    matched                            71,749  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        66,393
        from master                    66,393  (_merge==1)
        from using                          0  (_merge==2)

    matched                            44,407  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        15,312
        from master                    15,312  (_merge==1)
        from using                          0  (_merge==2)

    matched                            95,488  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        43,053
        from master                    43,053  (_merge==1)
        from using                          0  (_merge==2)

    matched                            67,747  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        76,583
        from master                    76,583  (_merge==1)
        from using                          0  (_merge==2)

    matched                            34,217  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

. 
. /*
> foreach var in land_r land_u building_all livestock trspt agri non_farm shares fin_other f
> in_gold fin_rec {
> replace `var' = 0 if mi(`var')
> } 
> */
.  
. qui compress

. save "${r_output}\NSS70_All",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> NSS70_All.dta saved

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(40,052 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_other gold f
> in_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1757877    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    39461.95    205416.2          0   3.26e+07
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(689 missing values generated)

. gen du_share = durable_other/asset
(689 missing values generated)

. gen gl_share = gold / asset
(8,648 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,845    .7495464    .2953897          0          1
    du_share |    107,845    .0652008    .1308526          0          1
    gl_share |     99,886     .113723    .2039159          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,845   454661258    .7486999    .302348          0          1
    du_share | 107,845   454661258    .0597428   .1247878          0          1
    gl_share |  99,886   415092770    .1272173   .2197015          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,845  2.0718e+09    .7685104   .2785787          0          1
    du_share | 107,845  2.0718e+09    .0614846   .1187822          0          1
    gl_share |  99,886  1.9006e+09    .1125415    .200551          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,787,706   588,920
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    35,572    17,930 1,447,452 1,339,411    50,171    63,913 1,544,320
     p50 |     2,000         0   452,000   385,000     9,000    25,000   485,400
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    33,306    16,475 1,643,910 1,525,683    59,373    64,471 1,739,055
     p50 |     2,000         0   529,700   455,000    15,000    25,000   560,120
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin   35572.17       2000
  fin_retire  17929.947          0
asset_non_~n    1447452     452000
 real_estate  1339411.5     385000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset  1544320.4     485400

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   35572.17     2000         44         48 |
  2. |  28,317         0    Retirement accounts   17929.95        0        -37          . |
  3. | 1528232   478,300   Non-financial assets    1447452   452000         -5         -5 |
  4. | 1441279   407,000            Real estate    1339412   385000         -7         -5 |
  5. |  58,660    11,680          Durable goods   50170.98     9000        -14        -23 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset    1544320   485400         -2         -3 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. ****************************************************************************
. * Description: Import NSS70 from Raw Files and save dta to Output Folder
. * Date: Oct 16, 2020
. * Version 1.2
. * Last Editor: Aline
. ****************************************************************************
. 
. ****************************************************************************
. clear 

. clear matrix

. ****************************************************************************
. 
. ****************************************************************************
. * Determine Whose Machine is running the code and set the global directory
. ****************************************************************************
. if "`c(username)'" == "wb308830" local pc = 0

. if "`c(username)'" != "wb308830" local pc = 1

. if `pc' == 0 global root "C:\Users\wb308830\OneDrive - WBG\Documents\TN\Data\NSS 70"

. if `pc' != 0 global root "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\N
> SS70"

. 
. di "$root"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70

. global r_input "${root}\Raw Data & Dictionaries"

. di "${r_input}"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Dictionaries

. global r_output "${root}\Data Output Files"

. 
. ****************************************************************************
. *gen date of survey 
. use "${r_input}\Visit 1_Block 1&2_Identification of sample household and particulars of fi
> eld operations.dta",clear

. gen month = real(substr(Survey_Date,3,2))

. gen year = 2013 //there's 2017 and 2019 should be mistake

. 
. gen date_survey = ym(year,month)

. format date_survey %tmMCY

. 
. keep HHID date_survey

. save "${r_output}\b2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b2.dta saved

. 
. 
. *gen id, wgt (hhwgt, popwgt) b3
. use "${r_input}\Visit 1_Block 3_Household Characteristics.dta",clear

. 
. rename (b3q1 Sector) (hhsize sector)

. //gen hhwgt = MLT 
. gen hhwgt = Weight_SS 

. 
. destring(hhsize),replace
hhsize: all characters numeric; replaced as byte

. gen pwgt = hhwgt * hhsize

. 
. destring(sector), replace
sector: all characters numeric; replaced as byte

. gen urban = sector - 1

. keep HHID hhwgt pwgt hhsize sector urban Weight_SS Weight_SC

. save "${r_output}\b3",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b3.dta saved

. 
. *gender from b4 (4)
. use "${r_input}\Visit 1 _Block 4_Demographic and other particulars of household members.dt
> a",clear

. *Keep head 
. keep if b4q1 == "01" // keep heads only 
(408,795 observations deleted)

. ren b4q5 head_age 

. 
. ren  b4q4 head_gender 

. destring head_gender, replace
head_gender: all characters numeric; replaced as byte

. label define gender 1 "Male" 2 "Female"

. label values head_gender gender 

. gen head_female = (head_gender == 2)*100

. 
. keep HHID head_age head_gender head_female

. save "${r_output}\b4",replace 
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b4.dta saved

. 
. *Asset non_fin： land from b5.1 & b5.2 (rural & urban) srl 99
. use "${r_input}\Visit 1_Block 5pt1_Details of land owned by the household as on 30.06.12.d
> ta",clear

. sum b5_1_6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b5_1_6 |    223,958    630116.4     2835074          0   2.49e+08

. rename State state

. 
. egen double land_r = sum(b5_1_6*(b5_1_1 == "99")), by(HHID)

. egen double land_r_man = sum(b5_1_6*(b5_1_1 != "99")), by(HHID)

. egen double land_r_resid = sum(b5_1_6*(b5_1_1 != "99")*( b5_1_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(156,468 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_r > land_r_man
  0

. count if land_r < land_r_man
  15

. 
. drop land_r

. rename land_r_man land_r 

. 
. keep HHID land_r land_r_resid

. save "${r_output}\b5_1",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_1.dta saved

. 
. use "${r_input}\Visit 1_Block 5pt2_Details of land owned by the household as on 30.06.12.d
> ta",clear

. count if b5_2_6 < 0
  2

. replace b5_2_6 = . if b5_2_6 < 0
(2 real changes made, 2 to missing)

. 
. egen double land_u = sum(b5_2_6*(b5_2_1 == "99")), by(HHID)

. egen double land_u_man = sum(b5_2_6*(b5_2_1 != "99")), by(HHID)

. egen double land_u_resid = sum(b5_2_6*(b5_2_1 != "99")*( b5_2_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(41,892 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_u > land_u_man
  0

. count if land_u < land_u_man
  16

. 
. drop land_u

. rename land_u_man land_u

. 
. keep HHID land_u land_u_resid

. save "${r_output}\b5_2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_2.dta saved

. 
. 
. 
. *Asset non_fin: building and constructions b6 srl 11
. use "${r_input}\Visit 1_Block 6_Buildings and other constructions owned by the household a
> s on 30.06.2012.dta",clear

. sum b6_q6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b6_q6 |    244,737    479786.6     8839515          0   1.85e+09

. 
. egen double building_all = sum(b6_q6*(b6_q3 == "11")), by(HHID)

. egen double building_all_man = sum(b6_q6*(b6_q3 != "11")),  by(HHID)

. 
. egen double building_resid = sum(b6_q6*(b6_q3 == "01")), by(HHID)

. egen double building_dwelling = sum(b6_q6*(inlist(b6_q3,"01","02","03"))), by(HHID)

. 
. egen double building_resid_area = sum(b6_q5*(inlist(b6_q3,"01","02","03"))), by(HHID)

. egen double building_dwelling_area = sum(b6_q5*(b6_q3 == "01")), by(HHID)

. 
. duplicates drop HHID,  force

Duplicates in terms of HHID

(149,298 observations deleted)

. 
. keep HHID building_all* building_resid building_resid_area building_dwelling building_dwel
> ling_area

. 
. *Check the manual (man) sum with survey sum
. count if building_resid > building_all
  2

. count if building_resid > building_all_man
  0

. 
. drop building_all

. ren building_all_man building_all 

. 
. save "${r_output}\b6",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b6.dta saved

. 
. *Asset non_fin: livestock and poultry b7 srl 22 
. use "${r_input}\Visit 1_Block 7_Livestock and poultry owned by the household on 30.06.2012
> .dta",clear

. destring b7_q2,replace
b7_q2: all characters numeric; replaced as byte

. sum b7_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b7_q5 |    176,881    23115.77    42294.12          0    2590000

. 
. egen double livestock = sum(b7_q5*(b7_q2 == 22)), by(HHID)

. egen double livestock_man = sum(b7_q5*(inrange(b7_q2,17,21))), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(132,557 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if livestock > livestock_man
  0

. count if livestock < livestock_man
  14

. 
. drop livestock

. rename livestock_man livestock

. 
. keep HHID livestock

. save "${r_output}\b7",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b7.dta saved

. 
. *Asset non_fin: transport equipment b8: srl 8
. use "${r_input}\Visit 1_Block 8_Transport equipment owned by the household on 30.06.2012.d
> ta",clear

. sum b8_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b8_q5 |    166,428    64309.42      250881          0   2.07e+07

. 
. egen double trspt = sum(b8_q5*(b8_q2 == "08")), by(HHID)

. egen double trspt_man = sum(b8_q5*(b8_q2 != "08")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(94,706 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if trspt > trspt_man
  0

. count if trspt < trspt_man
  9

. 
. drop trspt

. rename trspt_man trspt

. 
. keep HHID trspt

. save "${r_output}\b8",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b8.dta saved

. 
. *Asset non_fin: agricultural machinery and implements b9: srl 8 
. use "${r_input}\Visit 1_Block 9_Agricultural machinery and implements owned by the househo
> ld on 30.06.2012.dta",clear

. sum b9_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b9_q4 |    120,458    7046.966    42346.08         10    7700000

. 
. egen double agri = sum(b9_q4*(b9_q2 == "8")), by(HHID)

. egen double agri_man = sum(b9_q4*(b9_q2 != "8")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(72,196 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if agri > agri_man
  0

. count if agri < agri_man
  2

. 
. drop agri

. rename agri_man agri

. 
. keep HHID agri

. save "${r_output}\b9",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b9.dta saved

. 
. *Asset non_fin: non-farm business equipment b10 srl 15
. use "${r_input}\Visit 1_Block 10_Non-farm business equipment owned by the household as on 
> 30.06.2012.dta",clear

. destring b10_q2,replace
b10_q2: all characters numeric; replaced as byte

. sum b10_q3 //issue with raw-data.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b10_q3 |        119           0           0          0          0

. 
. egen double non_farm = sum(b10_q3*(b10_q2 == 15)), by(HHID)

. egen double non_farm_man = sum(b10_q3*inrange(b10_q2,12,14)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(60,778 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if non_farm > non_farm_man
  0

. count if non_farm < non_farm_man
  0

. 
. drop non_farm_man

. keep HHID non_farm

. save "${r_output}\b10",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b10.dta saved

. 
. *Asset fin: shares & debentures b11 
. use "${r_input}\Visit 1_Block 11_ Shares and debentures owned by the household in co-opera
> tive  societies & companies as on 30.06.2012 .dta",clear

. 
.  *Check the manual (man) sum with survey sum
.   preserve

.   egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

.   egen double shares_man = sum(b11_q6*(b11_q1 != "5")), by(HHID)

.   duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

.   count if shares > shares_man
  0

.   count if shares < shares_man
  0

.   restore 

. 
. sum b11_q6 if b11_q1 != "5" 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b11_q6 |      3,931    44989.44    324279.8     -50000   1.00e+07

. replace b11_q6 = . if b11_q6<0 //filter out the non-negative colums. 
(23 real changes made, 23 to missing)

. egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

. 
. keep HHID shares

. save "${r_output}\b11",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b11.dta saved

. 
. *Asset fin: other financial assets b12 srl 11 
. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inrange(b12_q1,1,5) )), by(HHID)

. 
. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   /*
> drop fin_other 
> ren fin_other_man fin_other
> */
. 
. keep HHID fin_other gold fin_retire

. save "${r_output}\b12",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b12.dta saved

. 
. *Asset fin: amount receivable b13 (mortgage srl 1, total srl 7)
. use "${r_input}\Visit 1_Block 13_Amount receivable by the household against different head
> s as on 30.06.2012.dta",clear

. sum b13_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b13_q4 |     13,807    63848.05    419515.8          0   2.00e+07

. 
. egen double fin_rec = sum(b13_q4*(b13_q2 == "7")), by(HHID)

. egen double fin_rec_man = sum(b13_q4*(b13_q2 != "7")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(7,033 observations deleted)

. 
.   *Check the manual (man) sum with survey sum
.   count if fin_rec > fin_rec_man
  0

.   count if fin_rec < fin_rec_man
  2

.  
. drop fin_rec

. ren fin_rec_man fin_rec

. keep HHID fin_rec

. save "${r_output}\b13",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b13.dta saved

. 
. *Debt: cash loands payable b14: Type of loan(8) Purpose of loan (11) Type of mortgage(13) 
> , srl 99 (total)
. use "${r_input}\Visit 1_Block 14",clear

. drop if b14_q1 == "99" //drop the total amount
(73,266 observations deleted)

. 
. *debt
. gen debt = b14_q17
(47,671 missing values generated)

. gen b14 = debt
(47,671 missing values generated)

. 
. *loan purpose
. gen loan_purpose = b14_q11
(4 missing values generated)

. gen hous_loan = (b14_q11 == "11")*debt
(47,671 missing values generated)

. 
. *credit agency
. gen credit_agency = b14_q6
(1 missing value generated)

. 
. destring(b14_q6),replace
b14_q6: all characters numeric; replaced as byte
(1 missing value generated)

. gen credit_formal = (!inrange(b14_q6,12,17)& b14_q6!=9)*debt
(47,671 missing values generated)

. 
. *mortgage
. gen mortgage_type = b14_q13
(7 missing values generated)

. gen has_mortgage =  (b14_q13 != "4")*debt
(47,671 missing values generated)

. 
. *borrowed amount
. gen br_amount = b14_q5
(1 missing value generated)

. 
. *aggregate at household level. *** When you collapse, check if any HH has two housing loan
> s - we don't want to combine them. In fact we should try and do all this in file 03_Mortga
> ge so we can keep file 01 clean while we play around with this data
. collapse (sum) hous_loan (sum) credit_formal (sum) has_mortgage  (sum) br_amount (sum) deb
> t,by(HHID)

. label var hous_loan "loan with purpose on housing"

. label var has_mortgage "loan with mortgage"

. 
. save "${r_output}\b14",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b14.dta saved

. 
. *Debt: kind of loan payable b15 col 11: housing 11
. use "${r_input}\Visit 1_Block 15_kind loans payable by the household.dta",replace

. save "${r_output}\b15",replace //late housing info
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b15.dta saved

. 
. 
. 
. *******merge to master data******************************
. use "${r_output}\b2",clear

. local flist "b3 b14 b13 b12 b11 b10 b9 b8 b7 b6 b5_1 b5_2 b4"

. 
. foreach f of local flist{
  2. merge 1:1 HHID using "${r_output}/`f'"
  3. drop _merge
  4. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        37,081
        from master                    37,081  (_merge==1)
        from using                          0  (_merge==2)

    matched                            73,719  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       104,025
        from master                   104,025  (_merge==1)
        from using                          0  (_merge==2)

    matched                             6,775  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,388
        from master                     9,388  (_merge==1)
        from using                          0  (_merge==2)

    matched                           101,412  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       106,964
        from master                   106,964  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,836  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        86,248
        from master                    86,248  (_merge==1)
        from using                          0  (_merge==2)

    matched                            24,552  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        62,530
        from master                    62,530  (_merge==1)
        from using                          0  (_merge==2)

    matched                            48,270  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        39,051
        from master                    39,051  (_merge==1)
        from using                          0  (_merge==2)

    matched                            71,749  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        66,393
        from master                    66,393  (_merge==1)
        from using                          0  (_merge==2)

    matched                            44,407  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        15,312
        from master                    15,312  (_merge==1)
        from using                          0  (_merge==2)

    matched                            95,488  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        43,053
        from master                    43,053  (_merge==1)
        from using                          0  (_merge==2)

    matched                            67,747  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        76,583
        from master                    76,583  (_merge==1)
        from using                          0  (_merge==2)

    matched                            34,217  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

. 
. /*
> foreach var in land_r land_u building_all livestock trspt agri non_farm shares fin_other f
> in_gold fin_rec {
> replace `var' = 0 if mi(`var')
> } 
> */
.  
. qui compress

. save "${r_output}\NSS70_All",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> NSS70_All.dta saved

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(40,216 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_other gold f
> in_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1743325    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(719 missing values generated)

. gen du_share = durable_other/asset
(719 missing values generated)

. gen gl_share = gold / asset
(8,678 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,815    .7558262    .2951223          0          1
    du_share |    107,815    .0674781     .136221          0          1
    gl_share |     99,856     .119122    .2145012          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,815   454432458    .7543695   .3021585          0          1
    du_share | 107,815   454432458    .0619051   .1306082          0          1
    gl_share |  99,856   414863969    .1325032   .2294712          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,815  2.0714e+09     .773865   .2783108          0          1
    du_share | 107,815  2.0714e+09     .063232   .1234101          0          1
    gl_share |  99,856  1.9002e+09    .1169122   .2096048          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,772,877   581,485
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    23,776    30,958 1,447,452 1,339,411    50,171    63,913 1,532,524
     p50 |     1,200         0   452,000   385,000     9,000    25,000   478,825
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    21,578    29,323 1,643,910 1,525,683    59,373    64,471 1,727,327
     p50 |     1,300         0   529,700   455,000    15,000    25,000   557,000
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  23775.776       1200
  fin_retire  30958.251          0
asset_non_~n    1447452     452000
 real_estate  1339411.5     385000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset    1532524     478825

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   23775.78     1200         -4        -11 |
  2. |  28,317         0    Retirement accounts   30958.25        0          9          . |
  3. | 1528232   478,300   Non-financial assets    1447452   452000         -5         -5 |
  4. | 1441279   407,000            Real estate    1339412   385000         -7         -5 |
  5. |  58,660    11,680          Durable goods   50170.98     9000        -14        -23 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset    1532524   478825         -3         -5 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. sum gold,de

                            gold
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%         1000              0       Obs              99,909
25%         7500              0       Sum of Wgt.      99,909

50%        25000                      Mean           64131.28
                        Largest       Std. Dev.      161287.7
75%        68400        8535000
90%       150000        9000000       Variance       2.60e+10
95%       250000       1.20e+07       Skewness       24.62278
99%       550000       1.29e+07       Kurtosis       1264.062

. sum asset,de

                            asset
-------------------------------------------------------------
      Percentiles      Smallest
 1%         1100              0
 5%        30000              0
10%        72000              0       Obs             108,534
25%       207915              0       Sum of Wgt.     108,534

50%       581485                      Mean            1772877
                        Largest       Std. Dev.      1.14e+07
75%      1536200       1.00e+09
90%      3667500       1.45e+09       Variance       1.31e+14
95%      6206754       1.75e+09       Skewness       105.1892
99%     1.71e+07       1.85e+09       Kurtosis       14642.97

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_resid land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(39,816 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all livestock trspt agri non_farm shares fin_other gold f
> in_rec building_resid 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
   livestock |     44,407    32474.12    54060.96          0    2590000
-------------+---------------------------------------------------------
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
-------------+---------------------------------------------------------
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07
building_r~d |     95,488    523603.5     9808247          0   1.85e+09

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(678 missing values generated)

. gen du_share = durable_other/asset
(678 missing values generated)

. gen gl_share = gold / asset
(8,637 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    .7419904    .2971178          0          1
    du_share |    107,856    .0631002    .1270273          0          1
    gl_share |     99,897    .1093642    .1977933          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    .7443026   .3032822          0          1
    du_share | 107,856   454809072    .0583952    .121774          0          1
    gl_share |  99,897   415240583    .1236733   .2144628          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856  2.0721e+09    .7644404   .2796979          0          1
    du_share | 107,856  2.0721e+09    .0604126   .1166633          0          1
    gl_share |  99,897  1.9009e+09    .1097024   .1959486          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,812,467   602,269
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    23,776    30,958 1,447,452 1,339,411    50,171    63,913 1,560,555
     p50 |     1,200         0   452,000   385,000     9,000    25,000   490,400
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    21,578    29,323 1,643,910 1,525,683    59,373    64,471 1,754,095
     p50 |     1,300         0   529,700   455,000    15,000    25,000   567,500
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  23775.776       1200
  fin_retire  30958.251          0
asset_non_~n    1447452     452000
 real_estate  1339411.5     385000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset    1560555     490400

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   23775.78     1200         -4        -11 |
  2. |  28,317         0    Retirement accounts   30958.25        0          9          . |
  3. | 1528232   478,300   Non-financial assets    1447452   452000         -5         -5 |
  4. | 1441279   407,000            Real estate    1339412   385000         -7         -5 |
  5. |  58,660    11,680          Durable goods   50170.98     9000        -14        -23 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset    1560555   490400         -1         -2 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(37,081 missing values generated)

. gen double wealth_ln = ln(wealth)
(39,816 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset
(678 missing values generated)

. gen du_share = durable_other/asset
(678 missing values generated)

. gen gl_share = gold / asset
(8,637 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    .7725209    .2918087          0          1
    du_share |    107,856    .0631002    .1270273          0          1
    gl_share |     99,897    .1093642    .1977933          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    .7729683   .2992245          0          1
    du_share | 107,856   454809072    .0583952    .121774          0          1
    gl_share |  99,897   415240583    .1236733   .2144628          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856  2.0721e+09    .7935721   .2741129          0          1
    du_share | 107,856  2.0721e+09    .0604126   .1166633          0          1
    gl_share |  99,897  1.9009e+09    .1097024   .1959486          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,812,467   602,269
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    23,776    30,958 1,508,748 1,400,708    50,171    63,913 1,560,555
     p50 |     1,200         0   468,700   400,000     9,000    25,000   490,400
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    21,578    29,323 1,705,749 1,587,522    59,373    64,471 1,754,095
     p50 |     1,300         0   550,000   479,415    15,000    25,000   567,500
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  23775.776       1200
  fin_retire  30958.251          0
asset_non_~n  1508748.2     468700
 real_estate  1400707.8     400000
durable_ot~r  50170.976       9000
        gold  63912.865      25000
       asset    1560555     490400

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(108,527 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   23775.78     1200         -4        -11 |
  2. |  28,317         0    Retirement accounts   30958.25        0          9          . |
  3. | 1528232   478,300   Non-financial assets    1508748   468700         -1         -2 |
  4. | 1441279   407,000            Real estate    1400708   400000         -3         -2 |
  5. |  58,660    11,680          Durable goods   50170.98     9000        -14        -23 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63912.87    25000         10         25 |
  7. | 1581228   501,880            Total asset    1560555   490400         -1         -2 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. sum gold,de

                            gold
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%         1000              0       Obs              99,909
25%         7500              0       Sum of Wgt.      99,909

50%        25000                      Mean           64131.28
                        Largest       Std. Dev.      161287.7
75%        68400        8535000
90%       150000        9000000       Variance       2.60e+10
95%       250000       1.20e+07       Skewness       24.62278
99%       550000       1.29e+07       Kurtosis       1264.062

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. ****************************************************************************
. * Description: Import NSS70 from Raw Files and save dta to Output Folder
. * Date: Oct 16, 2020
. * Version 1.2
. * Last Editor: Aline
. ****************************************************************************
. 
. ****************************************************************************
. clear 

. clear matrix

. ****************************************************************************
. 
. ****************************************************************************
. * Determine Whose Machine is running the code and set the global directory
. ****************************************************************************
. if "`c(username)'" == "wb308830" local pc = 0

. if "`c(username)'" != "wb308830" local pc = 1

. if `pc' == 0 global root "C:\Users\wb308830\OneDrive - WBG\Documents\TN\Data\NSS 70"

. if `pc' != 0 global root "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\N
> SS70"

. 
. di "$root"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70

. global r_input "${root}\Raw Data & Dictionaries"

. di "${r_input}"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Dictionaries

. global r_output "${root}\Data Output Files"

. 
. ****************************************************************************
. *gen date of survey 
. use "${r_input}\Visit 1_Block 1&2_Identification of sample household and particulars of fi
> eld operations.dta",clear

. gen month = real(substr(Survey_Date,3,2))

. gen year = 2013 //there's 2017 and 2019 should be mistake

. 
. gen date_survey = ym(year,month)

. format date_survey %tmMCY

. 
. keep HHID date_survey

. save "${r_output}\b2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b2.dta saved

. 
. 
. *gen id, wgt (hhwgt, popwgt) b3
. use "${r_input}\Visit 1_Block 3_Household Characteristics.dta",clear

. 
. rename (b3q1 Sector) (hhsize sector)

. //gen hhwgt = MLT 
. gen hhwgt = Weight_SS 

. 
. destring(hhsize),replace
hhsize: all characters numeric; replaced as byte

. gen pwgt = hhwgt * hhsize

. 
. destring(sector), replace
sector: all characters numeric; replaced as byte

. gen urban = sector - 1

. keep HHID hhwgt pwgt hhsize sector urban Weight_SS Weight_SC

. save "${r_output}\b3",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b3.dta saved

. 
. *gender from b4 (4)
. use "${r_input}\Visit 1 _Block 4_Demographic and other particulars of household members.dt
> a",clear

. *Keep head 
. keep if b4q1 == "01" // keep heads only 
(408,795 observations deleted)

. ren b4q5 head_age 

. 
. ren  b4q4 head_gender 

. destring head_gender, replace
head_gender: all characters numeric; replaced as byte

. label define gender 1 "Male" 2 "Female"

. label values head_gender gender 

. gen head_female = (head_gender == 2)*100

. 
. keep HHID head_age head_gender head_female

. save "${r_output}\b4",replace 
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b4.dta saved

. 
. *Asset non_fin： land from b5.1 & b5.2 (rural & urban) srl 99
. use "${r_input}\Visit 1_Block 5pt1_Details of land owned by the household as on 30.06.12.d
> ta",clear

. sum b5_1_6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b5_1_6 |    223,958    630116.4     2835074          0   2.49e+08

. rename State state

. 
. egen double land_r = sum(b5_1_6*(b5_1_1 == "99")), by(HHID)

. egen double land_r_man = sum(b5_1_6*(b5_1_1 != "99")), by(HHID)

. egen double land_r_resid = sum(b5_1_6*(b5_1_1 != "99")*( b5_1_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(156,468 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_r > land_r_man
  0

. count if land_r < land_r_man
  15

. 
. drop land_r

. rename land_r_man land_r 

. 
. keep HHID land_r land_r_resid

. save "${r_output}\b5_1",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_1.dta saved

. 
. use "${r_input}\Visit 1_Block 5pt2_Details of land owned by the household as on 30.06.12.d
> ta",clear

. count if b5_2_6 < 0
  2

. replace b5_2_6 = . if b5_2_6 < 0
(2 real changes made, 2 to missing)

. 
. egen double land_u = sum(b5_2_6*(b5_2_1 == "99")), by(HHID)

. egen double land_u_man = sum(b5_2_6*(b5_2_1 != "99")), by(HHID)

. egen double land_u_resid = sum(b5_2_6*(b5_2_1 != "99")*( b5_2_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(41,892 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_u > land_u_man
  0

. count if land_u < land_u_man
  16

. 
. drop land_u

. rename land_u_man land_u

. 
. keep HHID land_u land_u_resid

. save "${r_output}\b5_2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_2.dta saved

. 
. 
. 
. *Asset non_fin: building and constructions b6 srl 11
. use "${r_input}\Visit 1_Block 6_Buildings and other constructions owned by the household a
> s on 30.06.2012.dta",clear

. sum b6_q6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b6_q6 |    244,737    479786.6     8839515          0   1.85e+09

. 
. egen double building_all = sum(b6_q6*(b6_q3 == "11")), by(HHID)

. egen double building_all_man = sum(b6_q6*(b6_q3 != "11")),  by(HHID)

. 
. egen double building_resid = sum(b6_q6*(b6_q3 == "01")), by(HHID)

. egen double building_dwelling = sum(b6_q6*(inlist(b6_q3,"01","02","03"))), by(HHID)

. 
. egen double building_resid_area = sum(b6_q5*(inlist(b6_q3,"01","02","03"))), by(HHID)

. egen double building_dwelling_area = sum(b6_q5*(b6_q3 == "01")), by(HHID)

. 
. duplicates drop HHID,  force

Duplicates in terms of HHID

(149,298 observations deleted)

. 
. keep HHID building_all* building_resid building_resid_area building_dwelling building_dwel
> ling_area

. 
. *Check the manual (man) sum with survey sum
. count if building_resid > building_all
  2

. count if building_resid > building_all_man
  0

. 
. drop building_all

. ren building_all_man building_all 

. 
. save "${r_output}\b6",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b6.dta saved

. 
. *Asset non_fin: livestock and poultry b7 srl 22 
. use "${r_input}\Visit 1_Block 7_Livestock and poultry owned by the household on 30.06.2012
> .dta",clear

. destring b7_q2,replace
b7_q2: all characters numeric; replaced as byte

. sum b7_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b7_q5 |    176,881    23115.77    42294.12          0    2590000

. 
. egen double livestock = sum(b7_q5*(b7_q2 == 22)), by(HHID)

. egen double livestock_man = sum(b7_q5*(inrange(b7_q2,17,21))), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(132,557 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if livestock > livestock_man
  0

. count if livestock < livestock_man
  14

. 
. drop livestock

. rename livestock_man livestock

. 
. keep HHID livestock

. save "${r_output}\b7",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b7.dta saved

. 
. *Asset non_fin: transport equipment b8: srl 8
. use "${r_input}\Visit 1_Block 8_Transport equipment owned by the household on 30.06.2012.d
> ta",clear

. sum b8_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b8_q5 |    166,428    64309.42      250881          0   2.07e+07

. 
. egen double trspt = sum(b8_q5*(b8_q2 == "08")), by(HHID)

. egen double trspt_man = sum(b8_q5*(b8_q2 != "08")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(94,706 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if trspt > trspt_man
  0

. count if trspt < trspt_man
  9

. 
. drop trspt

. rename trspt_man trspt

. 
. keep HHID trspt

. save "${r_output}\b8",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b8.dta saved

. 
. *Asset non_fin: agricultural machinery and implements b9: srl 8 
. use "${r_input}\Visit 1_Block 9_Agricultural machinery and implements owned by the househo
> ld on 30.06.2012.dta",clear

. sum b9_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b9_q4 |    120,458    7046.966    42346.08         10    7700000

. 
. egen double agri = sum(b9_q4*(b9_q2 == "8")), by(HHID)

. egen double agri_man = sum(b9_q4*(b9_q2 != "8")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(72,196 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if agri > agri_man
  0

. count if agri < agri_man
  2

. 
. drop agri

. rename agri_man agri

. 
. keep HHID agri

. save "${r_output}\b9",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b9.dta saved

. 
. *Asset non_fin: non-farm business equipment b10 srl 15
. use "${r_input}\Visit 1_Block 10_Non-farm business equipment owned by the household as on 
> 30.06.2012.dta",clear

. destring b10_q2,replace
b10_q2: all characters numeric; replaced as byte

. sum b10_q3 //issue with raw-data.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b10_q3 |        119           0           0          0          0

. 
. egen double non_farm = sum(b10_q3*(b10_q2 == 15)), by(HHID)

. egen double non_farm_man = sum(b10_q3*inrange(b10_q2,12,14)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(60,778 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if non_farm > non_farm_man
  0

. count if non_farm < non_farm_man
  0

. 
. drop non_farm_man

. keep HHID non_farm

. save "${r_output}\b10",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b10.dta saved

. 
. *Asset fin: shares & debentures b11 
. use "${r_input}\Visit 1_Block 11_ Shares and debentures owned by the household in co-opera
> tive  societies & companies as on 30.06.2012 .dta",clear

. 
.  *Check the manual (man) sum with survey sum
.   preserve

.   egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

.   egen double shares_man = sum(b11_q6*(b11_q1 != "5")), by(HHID)

.   duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

.   count if shares > shares_man
  0

.   count if shares < shares_man
  0

.   restore 

. 
. sum b11_q6 if b11_q1 != "5" 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b11_q6 |      3,931    44989.44    324279.8     -50000   1.00e+07

. replace b11_q6 = . if b11_q6<0 //filter out the non-negative colums. 
(23 real changes made, 23 to missing)

. egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

. 
. keep HHID shares

. save "${r_output}\b11",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b11.dta saved

. 
. *Asset fin: other financial assets b12 srl 11 
. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inrange(b12_q1,1,5) )), by(HHID)

. 
. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   /*
> drop fin_other 
> ren fin_other_man fin_other
> */
. 
. keep HHID fin_other gold fin_retire

. save "${r_output}\b12",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b12.dta saved

. 
. *Asset fin: amount receivable b13 (mortgage srl 1, total srl 7)
. use "${r_input}\Visit 1_Block 13_Amount receivable by the household against different head
> s as on 30.06.2012.dta",clear

. sum b13_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b13_q4 |     13,807    63848.05    419515.8          0   2.00e+07

. 
. egen double fin_rec = sum(b13_q4*(b13_q2 == "7")), by(HHID)

. egen double fin_rec_man = sum(b13_q4*(b13_q2 != "7")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(7,033 observations deleted)

. 
.   *Check the manual (man) sum with survey sum
.   count if fin_rec > fin_rec_man
  0

.   count if fin_rec < fin_rec_man
  2

.  
. drop fin_rec

. ren fin_rec_man fin_rec

. keep HHID fin_rec

. save "${r_output}\b13",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b13.dta saved

. 
. *Debt: cash loands payable b14: Type of loan(8) Purpose of loan (11) Type of mortgage(13) 
> , srl 99 (total)
. use "${r_input}\Visit 1_Block 14",clear

. keep if b14_q1 == "99" 
(110,443 observations deleted)

. 
. *debt
. gen debt = b14_q17 
(27,282 missing values generated)

. keep HHID debt

. save "${r_output}\b14",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b14.dta saved

. 
. *Debt: kind of loan payable b15 col 11: housing 11
. use "${r_input}\Visit 1_Block 15_kind loans payable by the household.dta",replace

. save "${r_output}\b15",replace //late housing info
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b15.dta saved

. 
. 
. *******merge to master data******************************
. use "${r_output}\b2",clear

. local flist "b3 b14 b13 b12 b11 b10 b9 b8 b7 b6 b5_1 b5_2 b4"

. 
. foreach f of local flist{
  2. merge 1:1 HHID using "${r_output}/`f'"
  3. drop _merge
  4. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        37,534
        from master                    37,534  (_merge==1)
        from using                          0  (_merge==2)

    matched                            73,266  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       104,025
        from master                   104,025  (_merge==1)
        from using                          0  (_merge==2)

    matched                             6,775  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,388
        from master                     9,388  (_merge==1)
        from using                          0  (_merge==2)

    matched                           101,412  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       106,964
        from master                   106,964  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,836  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        86,248
        from master                    86,248  (_merge==1)
        from using                          0  (_merge==2)

    matched                            24,552  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        62,530
        from master                    62,530  (_merge==1)
        from using                          0  (_merge==2)

    matched                            48,270  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        39,051
        from master                    39,051  (_merge==1)
        from using                          0  (_merge==2)

    matched                            71,749  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        66,393
        from master                    66,393  (_merge==1)
        from using                          0  (_merge==2)

    matched                            44,407  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        15,312
        from master                    15,312  (_merge==1)
        from using                          0  (_merge==2)

    matched                            95,488  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        43,053
        from master                    43,053  (_merge==1)
        from using                          0  (_merge==2)

    matched                            67,747  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        76,583
        from master                    76,583  (_merge==1)
        from using                          0  (_merge==2)

    matched                            34,217  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

. 
. /*
> foreach var in land_r land_u building_all livestock trspt agri non_farm shares fin_other f
> in_gold fin_rec {
> replace `var' = 0 if mi(`var')
> } 
> */
.  
. qui compress

. save "${r_output}\NSS70_All",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> NSS70_All.dta saved

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset

. gen du_share = durable_other/asset

. gen gl_share = gold / asset
(7,959 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    .7725209    .2918087          0          1
    du_share |    107,856    .0631002    .1270273          0          1
    gl_share |     99,897    .1093642    .1977933          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    .7729683   .2992245          0          1
    du_share | 107,856   454809072    .0583952    .121774          0          1
    gl_share |  99,897   415240583    .1236733   .2144628          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856  2.0721e+09    .7935721   .2741129          0          1
    du_share | 107,856  2.0721e+09    .0604126   .1166633          0          1
    gl_share |  99,897  1.9009e+09    .1097024   .1959486          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,823,860   609,763
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") // total: 1,561,322   490,57
> 0

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    23,976    30,961 1,521,486 1,412,533    50,595    63,919 1,573,730
     p50 |     1,200         0   476,700   408,000     9,500    25,000   500,350
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") // total: 1,754,928   567,775

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    21,687    29,326 1,714,368 1,595,544    59,674    64,477 1,762,958
     p50 |     1,340         0   554,100   482,000    15,300    25,000   573,200
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  23976.499       1200
  fin_retire  30961.231          0
asset_non_~n  1521485.6     476700
 real_estate    1412533     408000
durable_ot~r  50594.536       9500
        gold  63919.019      25000
       asset  1573729.7     500350

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(107,849 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset    23976.5     1200         -3        -11 |
  2. |  28,317         0    Retirement accounts   30961.23        0          9          . |
  3. | 1528232   478,300   Non-financial assets    1521486   476700         -0         -0 |
  4. | 1441279   407,000            Real estate    1412533   408000         -2          0 |
  5. |  58,660    11,680          Durable goods   50594.54     9500        -14        -19 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63919.02    25000         10         25 |
  7. | 1581228   501,880            Total asset    1573730   500350         -0         -0 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0 //only include hosueholds with assets. 
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen re_share = real_estate/asset

. gen du_share = durable_other/asset

. gen gl_share = gold / asset
(7,959 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    .7725209    .2918087          0          1
    du_share |    107,856    .0631002    .1270273          0          1
    gl_share |     99,897    .1093642    .1977933          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    .7729683   .2992245          0          1
    du_share | 107,856   454809072    .0583952    .121774          0          1
    gl_share |  99,897   415240583    .1236733   .2144628          0          1

. sum re_share du_share gl_share [aw = pwgt] //gold is 11% closest with paper. 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856  2.0721e+09    .7935721   .2741129          0          1
    du_share | 107,856  2.0721e+09    .0604126   .1166633          0          1
    gl_share |  99,897  1.9009e+09    .1097024   .1959486          0          1

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. ****************************************************************************
. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0 //only include hosueholds with assets. 
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen double re_share = real_estate/asset

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0 //only include hosueholds with assets. 
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen double re_share = real_estate/asset

. gen double du_share = durable_other/asset

. gen double gl_share = gold /asset
(7,959 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    .7725209    .2918087          0          1
    du_share |    107,856    .0631002    .1270273          0          1
    gl_share |     99,897    .1093642    .1977933          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    .7729683   .2992245          0          1
    du_share | 107,856   454809072    .0583952    .121774          0          1
    gl_share |  99,897   415240583    .1236733   .2144628          0          1

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0 //only include hosueholds with assets. 
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen double re_share = real_estate/asset

. gen double du_share = durable_other/asset

. gen double gl_share = gold /asset
(7,959 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    .7725209    .2918087          0          1
    du_share |    107,856    .0631002    .1270273          0          1
    gl_share |     99,897    .1093642    .1977933          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    .7729683   .2992245          0          1
    du_share | 107,856   454809072    .0583952    .121774          0          1
    gl_share |  99,897   415240583    .1236733   .2144628          0          1

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,823,860   609,763
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") 

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    23,976    30,961 1,521,486 1,412,533    50,595    63,919 1,573,730
     p50 |     1,200         0   476,700   408,000     9,500    25,000   500,350
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") 

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    21,687    29,326 1,714,368 1,595,544    59,674    64,477 1,762,958
     p50 |     1,340         0   554,100   482,000    15,300    25,000   573,200
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  23976.499       1200
  fin_retire  30961.231          0
asset_non_~n  1521485.6     476700
 real_estate    1412533     408000
durable_ot~r  50594.536       9500
        gold  63919.019      25000
       asset  1573729.7     500350

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(107,849 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset    23976.5     1200         -3        -11 |
  2. |  28,317         0    Retirement accounts   30961.23        0          9          . |
  3. | 1528232   478,300   Non-financial assets    1521486   476700         -0         -0 |
  4. | 1441279   407,000            Real estate    1412533   408000         -2          0 |
  5. |  58,660    11,680          Durable goods   50594.54     9500        -14        -19 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63919.02    25000         10         25 |
  7. | 1581228   501,880            Total asset    1573730   500350         -0         -0 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    .7725209    .2918087          0          1
    du_share |    107,856    .0631002    .1270273          0          1
    gl_share |     99,897    .1093642    .1977933          0          1

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    .7729683   .2992245          0          1
    du_share | 107,856   454809072    .0583952    .121774          0          1
    gl_share |  99,897   415240583    .1236733   .2144628          0          1

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0 //only include hosueholds with assets. 
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen double re_share = real_estate/asset *100

. gen double du_share = durable_other/asset*100

. gen double gl_share = gold /asset*100
(7,959 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    77.25209    29.18087          0        100
    du_share |    107,856    6.310022    12.70273          0        100
    gl_share |     99,897    10.93642    19.77933          0        100

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    77.29683   29.92245          0        100
    du_share | 107,856   454809072    5.839521    12.1774          0        100
    gl_share |  99,897   415240583    12.36733   21.44628          0        100

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0 //only include hosueholds with assets. 
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen double re_share = real_estate/asset *100

. gen double du_share = durable_other/asset*100

. gen double gl_share = gold /asset*100
(7,959 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    77.25209    29.18087          0        100
    du_share |    107,856    6.310022    12.70273          0        100
    gl_share |     99,897    10.93642    19.77933          0        100

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    77.29683   29.92245          0        100
    du_share | 107,856   454809072    5.839521    12.1774          0        100
    gl_share |  99,897   415240583    12.36733   21.44628          0        100

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0 //only include hosueholds with assets. 
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen double re_share = real_estate/asset *100

. gen double du_share = durable_other/asset*100

. gen double gl_share = gold /asset*100
(7,959 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    77.25209    29.18087          0        100
    du_share |    107,856    6.310022    12.70273          0        100
    gl_share |     99,897    10.93642    19.77933          0        100

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    77.29683   29.92245          0        100
    du_share | 107,856   454809072    5.839521    12.1774          0        100
    gl_share |  99,897   415240583    12.36733   21.44628          0        100

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,823,860   609,763
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") 

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    23,976    30,961 1,521,486 1,412,533    50,595    63,919 1,573,730
     p50 |     1,200         0   476,700   408,000     9,500    25,000   500,350
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") 

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    21,687    29,326 1,714,368 1,595,544    59,674    64,477 1,762,958
     p50 |     1,340         0   554,100   482,000    15,300    25,000   573,200
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  23976.499       1200
  fin_retire  30961.231          0
asset_non_~n  1521485.6     476700
 real_estate    1412533     408000
durable_ot~r  50594.536       9500
        gold  63919.019      25000
       asset  1573729.7     500350

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(107,849 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset    23976.5     1200         -3        -11 |
  2. |  28,317         0    Retirement accounts   30961.23        0          9          . |
  3. | 1528232   478,300   Non-financial assets    1521486   476700         -0         -0 |
  4. | 1441279   407,000            Real estate    1412533   408000         -2          0 |
  5. |  58,660    11,680          Durable goods   50594.54     9500        -14        -19 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63919.02    25000         10         25 |
  7. | 1581228   501,880            Total asset    1573730   500350         -0         -0 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. sum gold,de

                            gold
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%         1000              0       Obs              99,897
25%         7500              0       Sum of Wgt.      99,897

50%        25000                      Mean           64138.98
                        Largest       Std. Dev.      161295.9
75%        68425        8535000
90%       150000        9000000       Variance       2.60e+10
95%       250000       1.20e+07       Skewness       24.62186
99%       550000       1.29e+07       Kurtosis       1263.953

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. ****************************************************************************
. * Description: Import NSS70 from Raw Files and save dta to Output Folder
. * Date: Oct 16, 2020
. * Version 1.2
. * Last Editor: Aline
. ****************************************************************************
. 
. ****************************************************************************
. clear 

. clear matrix

. ****************************************************************************
. 
. ****************************************************************************
. * Determine Whose Machine is running the code and set the global directory
. ****************************************************************************
. if "`c(username)'" == "wb308830" local pc = 0

. if "`c(username)'" != "wb308830" local pc = 1

. if `pc' == 0 global root "C:\Users\wb308830\OneDrive - WBG\Documents\TN\Data\NSS 70"

. if `pc' != 0 global root "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\N
> SS70"

. 
. di "$root"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70

. global r_input "${root}\Raw Data & Dictionaries"

. di "${r_input}"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Dictionaries

. global r_output "${root}\Data Output Files"

. 
. ****************************************************************************
. *gen date of survey 
. use "${r_input}\Visit 1_Block 1&2_Identification of sample household and particulars of fi
> eld operations.dta",clear

. gen month = real(substr(Survey_Date,3,2))

. gen year = 2013 //there's 2017 and 2019 should be mistake

. 
. gen date_survey = ym(year,month)

. format date_survey %tmMCY

. 
. keep HHID date_survey

. save "${r_output}\b2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b2.dta saved

. 
. 
. *gen id, wgt (hhwgt, popwgt) b3
. use "${r_input}\Visit 1_Block 3_Household Characteristics.dta",clear

. 
. rename (b3q1 Sector) (hhsize sector)

. //gen hhwgt = MLT 
. gen hhwgt = Weight_SS 

. 
. destring(hhsize),replace
hhsize: all characters numeric; replaced as byte

. gen pwgt = hhwgt * hhsize

. 
. destring(sector), replace
sector: all characters numeric; replaced as byte

. gen urban = sector - 1

. keep HHID hhwgt pwgt hhsize sector urban Weight_SS Weight_SC

. save "${r_output}\b3",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b3.dta saved

. 
. *gender from b4 (4)
. use "${r_input}\Visit 1 _Block 4_Demographic and other particulars of household members.dt
> a",clear

. *Keep head 
. keep if b4q1 == "01" // keep heads only 
(408,795 observations deleted)

. ren b4q5 head_age 

. 
. ren  b4q4 head_gender 

. destring head_gender, replace
head_gender: all characters numeric; replaced as byte

. label define gender 1 "Male" 2 "Female"

. label values head_gender gender 

. gen head_female = (head_gender == 2)*100

. 
. keep HHID head_age head_gender head_female

. save "${r_output}\b4",replace 
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b4.dta saved

. 
. *Asset non_fin： land from b5.1 & b5.2 (rural & urban) srl 99
. use "${r_input}\Visit 1_Block 5pt1_Details of land owned by the household as on 30.06.12.d
> ta",clear

. sum b5_1_6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b5_1_6 |    223,958    630116.4     2835074          0   2.49e+08

. rename State state

. 
. egen double land_r = sum(b5_1_6*(b5_1_1 == "99")), by(HHID)

. egen double land_r_man = sum(b5_1_6*(b5_1_1 != "99")), by(HHID)

. egen double land_r_resid = sum(b5_1_6*(b5_1_1 != "99")*( b5_1_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(156,468 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_r > land_r_man
  0

. count if land_r < land_r_man
  15

. 
. drop land_r

. rename land_r_man land_r 

. 
. keep HHID land_r land_r_resid

. save "${r_output}\b5_1",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_1.dta saved

. 
. use "${r_input}\Visit 1_Block 5pt2_Details of land owned by the household as on 30.06.12.d
> ta",clear

. count if b5_2_6 < 0
  2

. replace b5_2_6 = . if b5_2_6 < 0
(2 real changes made, 2 to missing)

. 
. egen double land_u = sum(b5_2_6*(b5_2_1 == "99")), by(HHID)

. egen double land_u_man = sum(b5_2_6*(b5_2_1 != "99")), by(HHID)

. egen double land_u_resid = sum(b5_2_6*(b5_2_1 != "99")*( b5_2_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(41,892 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_u > land_u_man
  0

. count if land_u < land_u_man
  16

. 
. drop land_u

. rename land_u_man land_u

. 
. keep HHID land_u land_u_resid

. save "${r_output}\b5_2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_2.dta saved

. 
. 
. 
. *Asset non_fin: building and constructions b6 srl 11
. use "${r_input}\Visit 1_Block 6_Buildings and other constructions owned by the household a
> s on 30.06.2012.dta",clear

. sum b6_q6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b6_q6 |    244,737    479786.6     8839515          0   1.85e+09

. 
. egen double building_all = sum(b6_q6*(b6_q3 == "11")), by(HHID)

. egen double building_all_man = sum(b6_q6*(b6_q3 != "11")),  by(HHID)

. 
. egen double building_resid = sum(b6_q6*(b6_q3 == "01")), by(HHID)

. egen double building_dwelling = sum(b6_q6*(inlist(b6_q3,"01","02","03"))), by(HHID)

. 
. egen double building_resid_area = sum(b6_q5*(inlist(b6_q3,"01","02","03"))), by(HHID)

. egen double building_dwelling_area = sum(b6_q5*(b6_q3 == "01")), by(HHID)

. 
. duplicates drop HHID,  force

Duplicates in terms of HHID

(149,298 observations deleted)

. 
. keep HHID building_all* building_resid building_resid_area building_dwelling building_dwel
> ling_area

. 
. *Check the manual (man) sum with survey sum
. count if building_resid > building_all
  2

. count if building_resid > building_all_man
  0

. 
. drop building_all

. ren building_all_man building_all 

. 
. save "${r_output}\b6",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b6.dta saved

. 
. *Asset non_fin: livestock and poultry b7 srl 22 
. use "${r_input}\Visit 1_Block 7_Livestock and poultry owned by the household on 30.06.2012
> .dta",clear

. destring b7_q2,replace
b7_q2: all characters numeric; replaced as byte

. sum b7_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b7_q5 |    176,881    23115.77    42294.12          0    2590000

. 
. egen double livestock = sum(b7_q5*(b7_q2 == 22)), by(HHID)

. egen double livestock_man = sum(b7_q5*(inrange(b7_q2,17,21))), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(132,557 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if livestock > livestock_man
  0

. count if livestock < livestock_man
  14

. 
. drop livestock

. rename livestock_man livestock

. 
. keep HHID livestock

. save "${r_output}\b7",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b7.dta saved

. 
. *Asset non_fin: transport equipment b8: srl 8
. use "${r_input}\Visit 1_Block 8_Transport equipment owned by the household on 30.06.2012.d
> ta",clear

. sum b8_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b8_q5 |    166,428    64309.42      250881          0   2.07e+07

. 
. egen double trspt = sum(b8_q5*(b8_q2 == "08")), by(HHID)

. egen double trspt_man = sum(b8_q5*(b8_q2 != "08")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(94,706 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if trspt > trspt_man
  0

. count if trspt < trspt_man
  9

. 
. drop trspt

. rename trspt_man trspt

. 
. keep HHID trspt

. save "${r_output}\b8",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b8.dta saved

. 
. *Asset non_fin: agricultural machinery and implements b9: srl 8 
. use "${r_input}\Visit 1_Block 9_Agricultural machinery and implements owned by the househo
> ld on 30.06.2012.dta",clear

. sum b9_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b9_q4 |    120,458    7046.966    42346.08         10    7700000

. 
. egen double agri = sum(b9_q4*(b9_q2 == "8")), by(HHID)

. egen double agri_man = sum(b9_q4*(b9_q2 != "8")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(72,196 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if agri > agri_man
  0

. count if agri < agri_man
  2

. 
. drop agri

. rename agri_man agri

. 
. keep HHID agri

. save "${r_output}\b9",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b9.dta saved

. 
. *Asset non_fin: non-farm business equipment b10 srl 15
. use "${r_input}\Visit 1_Block 10_Non-farm business equipment owned by the household as on 
> 30.06.2012.dta",clear

. destring b10_q2,replace
b10_q2: all characters numeric; replaced as byte

. sum b10_q3 //issue with raw-data.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b10_q3 |        119           0           0          0          0

. 
. egen double non_farm = sum(b10_q3*(b10_q2 == 15)), by(HHID)

. egen double non_farm_man = sum(b10_q3*inrange(b10_q2,12,14)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(60,778 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if non_farm > non_farm_man
  0

. count if non_farm < non_farm_man
  0

. 
. drop non_farm_man

. keep HHID non_farm

. save "${r_output}\b10",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b10.dta saved

. 
. *Asset fin: shares & debentures b11 
. use "${r_input}\Visit 1_Block 11_ Shares and debentures owned by the household in co-opera
> tive  societies & companies as on 30.06.2012 .dta",clear

. 
.  *Check the manual (man) sum with survey sum
.   preserve

.   egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

.   egen double shares_man = sum(b11_q6*(b11_q1 != "5")), by(HHID)

.   duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

.   count if shares > shares_man
  0

.   count if shares < shares_man
  0

.   restore 

. 
. sum b11_q6 if b11_q1 != "5" 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b11_q6 |      3,931    44989.44    324279.8     -50000   1.00e+07

. replace b11_q6 = . if b11_q6<0 //filter out the non-negative colums. 
(23 real changes made, 23 to missing)

. egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

. 
. keep HHID shares

. save "${r_output}\b11",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b11.dta saved

. 
. *Asset fin: other financial assets b12 srl 11 
. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,5,6))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inrange(b12_q1,1,4) | b12_q1 == 7)), by(HHID)

. 
. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   /*
> drop fin_other 
> ren fin_other_man fin_other
> */
. 
. keep HHID fin_other gold fin_retire

. save "${r_output}\b12",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b12.dta saved

. 
. *Asset fin: amount receivable b13 (mortgage srl 1, total srl 7)
. use "${r_input}\Visit 1_Block 13_Amount receivable by the household against different head
> s as on 30.06.2012.dta",clear

. sum b13_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b13_q4 |     13,807    63848.05    419515.8          0   2.00e+07

. 
. egen double fin_rec = sum(b13_q4*(b13_q2 == "7")), by(HHID)

. egen double fin_rec_man = sum(b13_q4*(b13_q2 != "7")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(7,033 observations deleted)

. 
.   *Check the manual (man) sum with survey sum
.   count if fin_rec > fin_rec_man
  0

.   count if fin_rec < fin_rec_man
  2

.  
. drop fin_rec

. ren fin_rec_man fin_rec

. keep HHID fin_rec

. save "${r_output}\b13",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b13.dta saved

. 
. *Debt: cash loands payable b14: Type of loan(8) Purpose of loan (11) Type of mortgage(13) 
> , srl 99 (total)
. use "${r_input}\Visit 1_Block 14",clear

. keep if b14_q1 == "99" 
(110,443 observations deleted)

. 
. *debt
. gen debt = b14_q17 
(27,282 missing values generated)

. keep HHID debt

. save "${r_output}\b14",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b14.dta saved

. 
. *Debt: kind of loan payable b15 col 11: housing 11
. use "${r_input}\Visit 1_Block 15_kind loans payable by the household.dta",replace

. save "${r_output}\b15",replace //late housing info
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b15.dta saved

. 
. 
. *******merge to master data******************************
. use "${r_output}\b2",clear

. local flist "b3 b14 b13 b12 b11 b10 b9 b8 b7 b6 b5_1 b5_2 b4"

. 
. foreach f of local flist{
  2. merge 1:1 HHID using "${r_output}/`f'"
  3. drop _merge
  4. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        37,534
        from master                    37,534  (_merge==1)
        from using                          0  (_merge==2)

    matched                            73,266  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       104,025
        from master                   104,025  (_merge==1)
        from using                          0  (_merge==2)

    matched                             6,775  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,388
        from master                     9,388  (_merge==1)
        from using                          0  (_merge==2)

    matched                           101,412  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       106,964
        from master                   106,964  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,836  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        86,248
        from master                    86,248  (_merge==1)
        from using                          0  (_merge==2)

    matched                            24,552  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        62,530
        from master                    62,530  (_merge==1)
        from using                          0  (_merge==2)

    matched                            48,270  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        39,051
        from master                    39,051  (_merge==1)
        from using                          0  (_merge==2)

    matched                            71,749  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        66,393
        from master                    66,393  (_merge==1)
        from using                          0  (_merge==2)

    matched                            44,407  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        15,312
        from master                    15,312  (_merge==1)
        from using                          0  (_merge==2)

    matched                            95,488  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        43,053
        from master                    43,053  (_merge==1)
        from using                          0  (_merge==2)

    matched                            67,747  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        76,583
        from master                    76,583  (_merge==1)
        from using                          0  (_merge==2)

    matched                            34,217  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

. 
. /*
> foreach var in land_r land_u building_all livestock trspt agri non_farm shares fin_other f
> in_gold fin_rec {
> replace `var' = 0 if mi(`var')
> } 
> */
.  
. qui compress

. save "${r_output}\NSS70_All",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> NSS70_All.dta saved

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    39461.95    205416.2          0   3.26e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0 //only include hosueholds with assets. 
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen double re_share = real_estate/asset *100

. gen double du_share = durable_other/asset*100

. gen double gl_share = gold /asset*100
(7,959 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    77.25209    29.18087          0        100
    du_share |    107,856    6.310022    12.70273          0        100
    gl_share |     99,897    10.93642    19.77933          0        100

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    77.29683   29.92245          0        100
    du_share | 107,856   454809072    5.839521    12.1774          0        100
    gl_share |  99,897   415240583    12.36733   21.44628          0        100

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,823,860   609,763
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") 

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    35,872    17,932 1,521,486 1,412,533    50,595    63,919 1,573,730
     p50 |     2,000         0   476,700   408,000     9,500    25,000   500,350
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") 

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    33,474    16,477 1,714,368 1,595,544    59,674    64,477 1,762,958
     p50 |     2,000         0   554,100   482,000    15,300    25,000   573,200
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  35872.482       2000
  fin_retire  17931.673          0
asset_non_~n  1521485.6     476700
 real_estate    1412533     408000
durable_ot~r  50594.536       9500
        gold  63919.019      25000
       asset  1573729.7     500350

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(107,849 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset   35872.48     2000         45         48 |
  2. |  28,317         0    Retirement accounts   17931.67        0        -37          . |
  3. | 1528232   478,300   Non-financial assets    1521486   476700         -0         -0 |
  4. | 1441279   407,000            Real estate    1412533   408000         -2          0 |
  5. |  58,660    11,680          Durable goods   50594.54     9500        -14        -19 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63919.02    25000         10         25 |
  7. | 1581228   501,880            Total asset    1573730   500350         -0         -0 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. ****************************************************************************
. * Description: Import NSS70 from Raw Files and save dta to Output Folder
. * Date: Oct 16, 2020
. * Version 1.2
. * Last Editor: Aline
. ****************************************************************************
. 
. ****************************************************************************
. clear 

. clear matrix

. ****************************************************************************
. 
. ****************************************************************************
. * Determine Whose Machine is running the code and set the global directory
. ****************************************************************************
. if "`c(username)'" == "wb308830" local pc = 0

. if "`c(username)'" != "wb308830" local pc = 1

. if `pc' == 0 global root "C:\Users\wb308830\OneDrive - WBG\Documents\TN\Data\NSS 70"

. if `pc' != 0 global root "C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\N
> SS70"

. 
. di "$root"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70

. global r_input "${root}\Raw Data & Dictionaries"

. di "${r_input}"
C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Dictionaries

. global r_output "${root}\Data Output Files"

. 
. ****************************************************************************
. *gen date of survey 
. use "${r_input}\Visit 1_Block 1&2_Identification of sample household and particulars of fi
> eld operations.dta",clear

. gen month = real(substr(Survey_Date,3,2))

. gen year = 2013 //there's 2017 and 2019 should be mistake

. 
. gen date_survey = ym(year,month)

. format date_survey %tmMCY

. 
. keep HHID date_survey

. save "${r_output}\b2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b2.dta saved

. 
. 
. *gen id, wgt (hhwgt, popwgt) b3
. use "${r_input}\Visit 1_Block 3_Household Characteristics.dta",clear

. 
. rename (b3q1 Sector) (hhsize sector)

. //gen hhwgt = MLT 
. gen hhwgt = Weight_SS 

. 
. destring(hhsize),replace
hhsize: all characters numeric; replaced as byte

. gen pwgt = hhwgt * hhsize

. 
. destring(sector), replace
sector: all characters numeric; replaced as byte

. gen urban = sector - 1

. keep HHID hhwgt pwgt hhsize sector urban Weight_SS Weight_SC

. save "${r_output}\b3",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b3.dta saved

. 
. *gender from b4 (4)
. use "${r_input}\Visit 1 _Block 4_Demographic and other particulars of household members.dt
> a",clear

. *Keep head 
. keep if b4q1 == "01" // keep heads only 
(408,795 observations deleted)

. ren b4q5 head_age 

. 
. ren  b4q4 head_gender 

. destring head_gender, replace
head_gender: all characters numeric; replaced as byte

. label define gender 1 "Male" 2 "Female"

. label values head_gender gender 

. gen head_female = (head_gender == 2)*100

. 
. keep HHID head_age head_gender head_female

. save "${r_output}\b4",replace 
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b4.dta saved

. 
. *Asset non_fin： land from b5.1 & b5.2 (rural & urban) srl 99
. use "${r_input}\Visit 1_Block 5pt1_Details of land owned by the household as on 30.06.12.d
> ta",clear

. sum b5_1_6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b5_1_6 |    223,958    630116.4     2835074          0   2.49e+08

. rename State state

. 
. egen double land_r = sum(b5_1_6*(b5_1_1 == "99")), by(HHID)

. egen double land_r_man = sum(b5_1_6*(b5_1_1 != "99")), by(HHID)

. egen double land_r_resid = sum(b5_1_6*(b5_1_1 != "99")*( b5_1_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(156,468 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_r > land_r_man
  0

. count if land_r < land_r_man
  15

. 
. drop land_r

. rename land_r_man land_r 

. 
. keep HHID land_r land_r_resid

. save "${r_output}\b5_1",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_1.dta saved

. 
. use "${r_input}\Visit 1_Block 5pt2_Details of land owned by the household as on 30.06.12.d
> ta",clear

. count if b5_2_6 < 0
  2

. replace b5_2_6 = . if b5_2_6 < 0
(2 real changes made, 2 to missing)

. 
. egen double land_u = sum(b5_2_6*(b5_2_1 == "99")), by(HHID)

. egen double land_u_man = sum(b5_2_6*(b5_2_1 != "99")), by(HHID)

. egen double land_u_resid = sum(b5_2_6*(b5_2_1 != "99")*( b5_2_3 == "10")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(41,892 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if land_u > land_u_man
  0

. count if land_u < land_u_man
  16

. 
. drop land_u

. rename land_u_man land_u

. 
. keep HHID land_u land_u_resid

. save "${r_output}\b5_2",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b5_2.dta saved

. 
. 
. 
. *Asset non_fin: building and constructions b6 srl 11
. use "${r_input}\Visit 1_Block 6_Buildings and other constructions owned by the household a
> s on 30.06.2012.dta",clear

. sum b6_q6

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b6_q6 |    244,737    479786.6     8839515          0   1.85e+09

. 
. egen double building_all = sum(b6_q6*(b6_q3 == "11")), by(HHID)

. egen double building_all_man = sum(b6_q6*(b6_q3 != "11")),  by(HHID)

. 
. egen double building_resid = sum(b6_q6*(b6_q3 == "01")), by(HHID)

. egen double building_dwelling = sum(b6_q6*(inlist(b6_q3,"01","02","03"))), by(HHID)

. 
. egen double building_resid_area = sum(b6_q5*(inlist(b6_q3,"01","02","03"))), by(HHID)

. egen double building_dwelling_area = sum(b6_q5*(b6_q3 == "01")), by(HHID)

. 
. duplicates drop HHID,  force

Duplicates in terms of HHID

(149,298 observations deleted)

. 
. keep HHID building_all* building_resid building_resid_area building_dwelling building_dwel
> ling_area

. 
. *Check the manual (man) sum with survey sum
. count if building_resid > building_all
  2

. count if building_resid > building_all_man
  0

. 
. drop building_all

. ren building_all_man building_all 

. 
. save "${r_output}\b6",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b6.dta saved

. 
. *Asset non_fin: livestock and poultry b7 srl 22 
. use "${r_input}\Visit 1_Block 7_Livestock and poultry owned by the household on 30.06.2012
> .dta",clear

. destring b7_q2,replace
b7_q2: all characters numeric; replaced as byte

. sum b7_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b7_q5 |    176,881    23115.77    42294.12          0    2590000

. 
. egen double livestock = sum(b7_q5*(b7_q2 == 22)), by(HHID)

. egen double livestock_man = sum(b7_q5*(inrange(b7_q2,17,21))), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(132,557 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if livestock > livestock_man
  0

. count if livestock < livestock_man
  14

. 
. drop livestock

. rename livestock_man livestock

. 
. keep HHID livestock

. save "${r_output}\b7",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b7.dta saved

. 
. *Asset non_fin: transport equipment b8: srl 8
. use "${r_input}\Visit 1_Block 8_Transport equipment owned by the household on 30.06.2012.d
> ta",clear

. sum b8_q5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b8_q5 |    166,428    64309.42      250881          0   2.07e+07

. 
. egen double trspt = sum(b8_q5*(b8_q2 == "08")), by(HHID)

. egen double trspt_man = sum(b8_q5*(b8_q2 != "08")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(94,706 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if trspt > trspt_man
  0

. count if trspt < trspt_man
  9

. 
. drop trspt

. rename trspt_man trspt

. 
. keep HHID trspt

. save "${r_output}\b8",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b8.dta saved

. 
. *Asset non_fin: agricultural machinery and implements b9: srl 8 
. use "${r_input}\Visit 1_Block 9_Agricultural machinery and implements owned by the househo
> ld on 30.06.2012.dta",clear

. sum b9_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       b9_q4 |    120,458    7046.966    42346.08         10    7700000

. 
. egen double agri = sum(b9_q4*(b9_q2 == "8")), by(HHID)

. egen double agri_man = sum(b9_q4*(b9_q2 != "8")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(72,196 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if agri > agri_man
  0

. count if agri < agri_man
  2

. 
. drop agri

. rename agri_man agri

. 
. keep HHID agri

. save "${r_output}\b9",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b9.dta saved

. 
. *Asset non_fin: non-farm business equipment b10 srl 15
. use "${r_input}\Visit 1_Block 10_Non-farm business equipment owned by the household as on 
> 30.06.2012.dta",clear

. destring b10_q2,replace
b10_q2: all characters numeric; replaced as byte

. sum b10_q3 //issue with raw-data.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b10_q3 |        119           0           0          0          0

. 
. egen double non_farm = sum(b10_q3*(b10_q2 == 15)), by(HHID)

. egen double non_farm_man = sum(b10_q3*inrange(b10_q2,12,14)), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(60,778 observations deleted)

. 
. *Check the manual (man) sum with survey sum
. count if non_farm > non_farm_man
  0

. count if non_farm < non_farm_man
  0

. 
. drop non_farm_man

. keep HHID non_farm

. save "${r_output}\b10",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b10.dta saved

. 
. *Asset fin: shares & debentures b11 
. use "${r_input}\Visit 1_Block 11_ Shares and debentures owned by the household in co-opera
> tive  societies & companies as on 30.06.2012 .dta",clear

. 
.  *Check the manual (man) sum with survey sum
.   preserve

.   egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

.   egen double shares_man = sum(b11_q6*(b11_q1 != "5")), by(HHID)

.   duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

.   count if shares > shares_man
  0

.   count if shares < shares_man
  0

.   restore 

. 
. sum b11_q6 if b11_q1 != "5" 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b11_q6 |      3,931    44989.44    324279.8     -50000   1.00e+07

. replace b11_q6 = . if b11_q6<0 //filter out the non-negative colums. 
(23 real changes made, 23 to missing)

. egen double shares = sum(b11_q6*(b11_q1 == "5")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(3,949 observations deleted)

. 
. keep HHID shares

. save "${r_output}\b11",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b11.dta saved

. 
. *Asset fin: other financial assets b12 srl 11 
. use "${r_input}\Visit 1_Block 12_Financial assets other than shares and debentures owned b
> y the household as on 30.06.2012.dta",clear

. 
. destring b12_q1,replace
b12_q1: all characters numeric; replaced as byte

. count if b12_q3 < 0 
  1

. replace b12_q3 = . if b12_q3 <0
(1 real change made, 1 to missing)

. 
. egen double gold = sum(b12_q3*(b12_q1 == 12)), by(HHID)

. egen double fin_retire = sum(b12_q3*(inlist(b12_q1,6,7))), by(HHID) //retirement account

. egen double fin_other = sum(b12_q3*(inrange(b12_q1,1,5) )), by(HHID)

. 
. duplicates drop HHID, force

Duplicates in terms of HHID

(265,456 observations deleted)

.   
.   /*
> drop fin_other 
> ren fin_other_man fin_other
> */
. 
. keep HHID fin_other gold fin_retire

. save "${r_output}\b12",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b12.dta saved

. 
. *Asset fin: amount receivable b13 (mortgage srl 1, total srl 7)
. use "${r_input}\Visit 1_Block 13_Amount receivable by the household against different head
> s as on 30.06.2012.dta",clear

. sum b13_q4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      b13_q4 |     13,807    63848.05    419515.8          0   2.00e+07

. 
. egen double fin_rec = sum(b13_q4*(b13_q2 == "7")), by(HHID)

. egen double fin_rec_man = sum(b13_q4*(b13_q2 != "7")), by(HHID)

. duplicates drop HHID, force

Duplicates in terms of HHID

(7,033 observations deleted)

. 
.   *Check the manual (man) sum with survey sum
.   count if fin_rec > fin_rec_man
  0

.   count if fin_rec < fin_rec_man
  2

.  
. drop fin_rec

. ren fin_rec_man fin_rec

. keep HHID fin_rec

. save "${r_output}\b13",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b13.dta saved

. 
. *Debt: cash loands payable b14: Type of loan(8) Purpose of loan (11) Type of mortgage(13) 
> , srl 99 (total)
. use "${r_input}\Visit 1_Block 14",clear

. keep if b14_q1 == "99" 
(110,443 observations deleted)

. 
. *debt
. gen debt = b14_q17 
(27,282 missing values generated)

. keep HHID debt

. save "${r_output}\b14",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b14.dta saved

. 
. *Debt: kind of loan payable b15 col 11: housing 11
. use "${r_input}\Visit 1_Block 15_kind loans payable by the household.dta",replace

. save "${r_output}\b15",replace //late housing info
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> b15.dta saved

. 
. 
. *******merge to master data******************************
. use "${r_output}\b2",clear

. local flist "b3 b14 b13 b12 b11 b10 b9 b8 b7 b6 b5_1 b5_2 b4"

. 
. foreach f of local flist{
  2. merge 1:1 HHID using "${r_output}/`f'"
  3. drop _merge
  4. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        37,534
        from master                    37,534  (_merge==1)
        from using                          0  (_merge==2)

    matched                            73,266  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       104,025
        from master                   104,025  (_merge==1)
        from using                          0  (_merge==2)

    matched                             6,775  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,388
        from master                     9,388  (_merge==1)
        from using                          0  (_merge==2)

    matched                           101,412  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       106,964
        from master                   106,964  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,836  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        86,248
        from master                    86,248  (_merge==1)
        from using                          0  (_merge==2)

    matched                            24,552  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        62,530
        from master                    62,530  (_merge==1)
        from using                          0  (_merge==2)

    matched                            48,270  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        39,051
        from master                    39,051  (_merge==1)
        from using                          0  (_merge==2)

    matched                            71,749  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        66,393
        from master                    66,393  (_merge==1)
        from using                          0  (_merge==2)

    matched                            44,407  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        15,312
        from master                    15,312  (_merge==1)
        from using                          0  (_merge==2)

    matched                            95,488  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        43,053
        from master                    43,053  (_merge==1)
        from using                          0  (_merge==2)

    matched                            67,747  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                        76,583
        from master                    76,583  (_merge==1)
        from using                          0  (_merge==2)

    matched                            34,217  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           110,800  (_merge==3)
    -----------------------------------------

. 
. /*
> foreach var in land_r land_u building_all livestock trspt agri non_farm shares fin_other f
> in_gold fin_rec {
> replace `var' = 0 if mi(`var')
> } 
> */
.  
. qui compress

. save "${r_output}\NSS70_All",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> NSS70_All.dta saved

. 
end of do-file

. do "C:\Users\wb500886\AppData\Local\Temp\STD268_000000.tmp"

. use "${root}\Data Output Files\NSS70_All.dta",clear

. 
. *generate asset value by type
. egen double asset = rowtotal(land_r land_u building_all livestock trspt agri non_farm shar
> es fin_other fin_retire gold fin_rec) 

. 
. egen double durable_other = rowtotal(livestock trspt agri non_farm)

. 
. egen double real_estate = rowtotal(building_all land_r land_u)

. 
. egen double asset_non_fin = rowtotal(real_estate gold durable_other)

. 
. egen double asset_fin = rowtotal(shares fin_other fin_rec) 

. 
. *generate wealth data
. gen double wealth = asset - debt
(64,816 missing values generated)

. gen double wealth_ln = ln(wealth)
(67,355 missing values generated)

. 
. *summary statistics
. sum asset land_r land_u building_all building_resid livestock trspt agri non_farm shares f
> in_other gold fin_rec  

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       asset |    110,800     1782154    1.13e+07          0   1.85e+09
      land_r |     67,747     1041569     3905052          0   2.49e+08
      land_u |     34,217     1380122     8276187          0   1.28e+09
building_all |     95,488    614870.7    1.01e+07          0   1.85e+09
building_r~d |     95,488    523603.5     9808247          0   1.85e+09
-------------+---------------------------------------------------------
   livestock |     44,407    32474.12    54060.96          0    2590000
       trspt |     71,749    74586.56    279375.5          0   2.07e+07
        agri |     48,270     8792.89    50198.23          0    7700000
    non_farm |     24,552           0           0          0          0
      shares |      3,836    46152.68      351695          0   1.21e+07
-------------+---------------------------------------------------------
   fin_other |    101,412    23563.03    177000.4          0   3.25e+07
        gold |    101,412    63457.91    160273.4          0   1.29e+07
     fin_rec |      6,775    65060.67    424340.3          0   2.00e+07

. 
. ****************************************************************************
. * Asset allocation
. ****************************************************************************
. keep if head_age >= 24 //consistent with the paper restriction.
(2,266 observations deleted)

. keep if asset > 0 //only include hosueholds with assets. 
(678 observations deleted)

. 
. **share of real estate on 
. * real_estate (77%), durable good (7%), gold (11%)
. gen double re_share = real_estate/asset *100

. gen double du_share = durable_other/asset*100

. gen double gl_share = gold /asset*100
(7,959 missing values generated)

. 
. sum re_share du_share gl_share //gold is 11% closest with paper. 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    re_share |    107,856    77.25209    29.18087          0        100
    du_share |    107,856    6.310022    12.70273          0        100
    gl_share |     99,897    10.93642    19.77933          0        100

. sum re_share du_share gl_share [aw = hhwgt] 

    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max
-------------+-----------------------------------------------------------------
    re_share | 107,856   454809072    77.29683   29.92245          0        100
    du_share | 107,856   454809072    5.839521    12.1774          0        100
    gl_share |  99,897   415240583    12.36733   21.44628          0        100

. 
. ** USE TABLE 1 to try and match mean and median of assets. Paper has Mean of 1,581,228 and
>  Median of 501,880
. *Unweighted 
. tabstat asset, s(mean p50) format("%9.0fc") // 1,813,187   602,800

    variable |      mean       p50
-------------+--------------------
       asset | 1,823,860   609,763
----------------------------------

. *Weighted
. global asset_table "asset_fin fin_retire asset_non_fin real_estate durable_other gold asse
> t"

. tabstat $asset_table [aw=hhwgt], s(mean p50) format("%9.0fc") 

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    23,976    30,961 1,521,486 1,412,533    50,595    63,919 1,573,730
     p50 |     1,200         0   476,700   408,000     9,500    25,000   500,350
--------------------------------------------------------------------------------

. tabstat $asset_table [aw=pwgt], s(mean p50) format("%9.0fc") 

   stats |  as~t_fin  fin_re~e  as~n_fin  real_e~e  durabl~r      gold     asset
---------+----------------------------------------------------------------------
    mean |    21,687    29,326 1,714,368 1,595,544    59,674    64,477 1,762,958
     p50 |     1,340         0   554,100   482,000    15,300    25,000   573,200
--------------------------------------------------------------------------------

. 
. *write to the matrix
. preserve

. clear matrix

. eststo all: quietly estpost summarize $asset_table  [aw=hhwgt]

. 
. unab vars : $asset_table 

. local num : word count `vars'

. matrix m = J(`num',2,0)

. local i = 1

. 
. foreach var in $asset_table {
  2. qui sum `var' [aw=hhwgt],de
  3. matrix m[`i',1] = `r(mean)'
  4. matrix m[`i',2] = `r(p50)'
  5. local i = `i' + 1
  6. }

. 
. matrix rownames m = $asset_table

. matrix colnames m = mean p50

. matrix list m

m[7,2]
                   mean        p50
   asset_fin  23976.499       1200
  fin_retire  30961.231          0
asset_non_~n  1521485.6     476700
 real_estate    1412533     408000
durable_ot~r  50594.536       9500
        gold  63919.019      25000
       asset  1573729.7     500350

. 
. svmat m,names(col)

. keep mean p50

. keep if !mi(mean) | !mi(p50)
(107,849 observations deleted)

. gen name = _n

. save "${r_output}\m_asset",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Data Output Files\
> m_asset.dta saved

. 
. 
. *table 1 data to compare
. import excel "${r_input}\paper_tab_1.xlsx", sheet("Sheet1") firstrow clear

. save "${r_input}\tab_1.dta",replace
file C:\Users\wb500886\OneDrive - WBG\7_Housing\survey_all\nss_data\NSS70\Raw Data & Diction
> aries\tab_1.dta saved

. 
. keep if type == "asset"
(7 observations deleted)

. ren (mean p50)(mean_tb p50_tb)

. 
. merge 1:1 name using "${r_output}\m_asset"
(note: variable name was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 7  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. foreach v in mean p50 {
  2. gen double delta_`v' = (`v' - `v'_tb)/`v'_tb * 100
  3. format delta_`v' %9.0fc
  4. }
(1 missing value generated)

. 
. drop name type

. 
. list

     +------------------------------------------------------------------------------------+
     | mean_tb    p50_tb              name_full       mean      p50   delta_~n   delta~50 |
     |------------------------------------------------------------------------------------|
  1. |  24,681     1,350        Financial asset    23976.5     1200         -3        -11 |
  2. |  28,317         0    Retirement accounts   30961.23        0          9          . |
  3. | 1528232   478,300   Non-financial assets    1521486   476700         -0         -0 |
  4. | 1441279   407,000            Real estate    1412533   408000         -2          0 |
  5. |  58,660    11,680          Durable goods   50594.54     9500        -14        -19 |
     |------------------------------------------------------------------------------------|
  6. |  58,292    20,000           Gold/bullion   63919.02    25000         10         25 |
  7. | 1581228   501,880            Total asset    1573730   500350         -0         -0 |
     +------------------------------------------------------------------------------------+

. 
. restore

. 
end of do-file

